<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Começando com Rails — Ruby on Rails Guides</title>
  <link rel="stylesheet" type="text/css" href="stylesheets/style.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
  <link rel="stylesheet" type="text/css" href="stylesheets/highlight.css" data-turbolinks-track="reload">
  <link rel="stylesheet" type="text/css" href="stylesheets/search.css" data-turbolinks-track="reload">
  <link href="images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
  <script src="javascripts/turbolinks.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/clipboard.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/guides.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/search.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/lunr-documents.js" data-turbolinks-track="reload"></script>
  <script src="javascripts/lunr.js" data-turbolinks-track="reload"></script>
  <meta property="og:title" content="Começando com Rails — Ruby on Rails Guides" />
  <meta name="description" content="Começando com RailsEste guia aborda a instalação e a execução do Ruby on Rails.Depois de ler este guia, você vai saber: Como instalar o Rails, criar uma nova aplicação Rails e conectar sua aplicação com um banco de dados. A estrutura geral de uma aplicação Rails. Os princípios básicos do MVC (Model, View, Controller) e design RESTful. Como gerar rapidamente as peças iniciais de uma aplicação Rails." />
  <meta property="og:description" content="Começando com RailsEste guia aborda a instalação e a execução do Ruby on Rails.Depois de ler este guia, você vai saber: Como instalar o Rails, criar uma nova aplicação Rails e conectar sua aplicação com um banco de dados. A estrutura geral de uma aplicação Rails. Os princípios básicos do MVC (Model, View, Controller) e design RESTful. Como gerar rapidamente as peças iniciais de uma aplicação Rails." />
  <meta property="og:locale" content="pt_BR" />
  <meta property="og:site_name" content="Guia Ruby on Rails" />
  <meta property="og:image" content="https://avatars.githubusercontent.com/u/4223" />
  <meta property="og:type" content="website" />
</head>
<body class="guide">
  <div>
    <div id="version-badge">v6.1.0</div>
  </div>
  <div id="topNav">
    <div class="wrapper">
      <strong class="more-info-label">Veja mais em <a href="https://rubyonrails.org/">rubyonrails.org:</a> </strong>
      <span class="red-button more-info-button">
        Mais Ruby on Rails
      </span>
      <ul class="more-info-links s-hidden">
        <li class="more-info"><a href="https://weblog.rubyonrails.org/">Blog</a></li>
        <li class="more-info"><a href="https://guides.rubyonrails.org/">Guia oficial</a></li>
        <li class="more-info"><a href="https://api.rubyonrails.org/">API</a></li>
        <li class="more-info"><a href="https://discuss.rubyonrails.org/">Forum</a></li>
        <li class="more-info"><a href="https://github.com/rails/rails">Contribua no GitHub</a></li>
      </ul>
    </div>
  </div>
  <div id="header">
    <div class="wrapper clearfix">
      <h1><a href="index.html" title="Voltar para a página principal">Guiarails.com.br</a></h1>
      <ul class="nav">
        <li><a class="nav-item" href="index.html">Home</a></li>
        <li class="guides-search guides-search-large">
          <input class="search-box search-box-large nav-item" type="text" placeholder="Digite o termo...">
          <div class="search-results"></div>
          <div class="search-spinner">Aguarde...</div>
        </li>
        <li class="guides-index guides-index-large">
          <a href="index.html" id="guidesMenu" class="guides-index-item nav-item">Guias</a>
          <div id="guides" class="clearfix" style="display: none;">
            <hr />
            <dl class="guides-section-container">
                <div class="guides-section">
                  <dt>Comece aqui</dt>
                  <dd><a href="getting_started.html">Começando com Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Models</dt>
                  <dd><a href="active_record_basics.html">Active Record Basics</a></dd>
                  <dd><a href="active_record_migrations.html">Active Record Migrations</a></dd>
                  <dd><a href="active_record_validations.html">Active Record Validations</a></dd>
                  <dd><a href="active_record_callbacks.html">Active Record Callbacks</a></dd>
                  <dd><a href="association_basics.html">Active Record Associations</a></dd>
                  <dd><a href="active_record_querying.html">Active Record Query Interface</a></dd>
                  <dd><a href="active_model_basics.html">Active Model Basics</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Views</dt>
                  <dd><a href="action_view_overview.html">Action View Overview</a></dd>
                  <dd><a href="layouts_and_rendering.html">Layouts and Rendering in Rails</a></dd>
                  <dd><a href="form_helpers.html">Action View Form Helpers</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Controllers</dt>
                  <dd><a href="action_controller_overview.html">Action Controller Overview</a></dd>
                  <dd><a href="routing.html">Rails Routing from the Outside In</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Outros componentes</dt>
                  <dd><a href="active_support_core_extensions.html">Active Support Core Extensions</a></dd>
                  <dd><a href="action_mailer_basics.html">Action Mailer Basics</a></dd>
                  <dd><a href="action_mailbox_basics.html">Action Mailbox Basics</a></dd>
                  <dd><a href="action_text_overview.html">Action Text Overview</a></dd>
                  <dd><a href="active_job_basics.html">Active Job Basics</a></dd>
                  <dd><a href="active_storage_overview.html">Active Storage Overview</a></dd>
                  <dd><a href="action_cable_overview.html">Action Cable Overview</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Indo mais fundo</dt>
                  <dd><a href="i18n.html">Rails Internationalization (I18n) API</a></dd>
                  <dd><a href="testing.html">Testing Rails Applications</a></dd>
                  <dd><a href="security.html">Securing Rails Applications</a></dd>
                  <dd><a href="debugging_rails_applications.html">Debugging Rails Applications</a></dd>
                  <dd><a href="configuring.html">Configuring Rails Applications</a></dd>
                  <dd><a href="command_line.html">The Rails Command Line</a></dd>
                  <dd><a href="asset_pipeline.html">The Asset Pipeline</a></dd>
                  <dd><a href="working_with_javascript_in_rails.html">Working with JavaScript in Rails</a></dd>
                  <dd><a href="initialization.html">The Rails Initialization Process</a></dd>
                  <dd><a href="autoloading_and_reloading_constants.html">Autoloading and Reloading Constants (Zeitwerk Mode)</a></dd>
                  <dd><a href="autoloading_and_reloading_constants_classic_mode.html">Autoloading and Reloading Constants (Classic Mode)</a></dd>
                  <dd><a href="caching_with_rails.html">Caching with Rails: An Overview</a></dd>
                  <dd><a href="active_support_instrumentation.html">Active Support Instrumentation</a></dd>
                  <dd><a href="api_app.html">Using Rails for API-only Applications</a></dd>
                  <dd><a href="active_record_postgresql.html">Active Record and PostgreSQL</a></dd>
                  <dd><a href="active_record_multiple_databases.html">Multiple Databases with Active Record</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Estendendo o Rails</dt>
                  <dd><a href="plugins.html">The Basics of Creating Rails Plugins</a></dd>
                  <dd><a href="rails_on_rack.html">Rails on Rack</a></dd>
                  <dd><a href="generators.html">Creating and Customizing Rails Generators &amp; Templates</a></dd>
                  <dd><a href="engines.html">Getting Started with Engines</a></dd>
                  <dd><a href="threading_and_code_execution.html">Threading and Code Execution in Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Contribuições</dt>
                  <dd><a href="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails</a></dd>
                  <dd><a href="api_documentation_guidelines.html">API Documentation Guidelines</a></dd>
                  <dd><a href="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Políticas</dt>
                  <dd><a href="maintenance_policy.html">Maintenance Policy for Ruby on Rails</a></dd>
                </div>
                <div class="guides-section">
                  <dt>Release Notes</dt>
                  <dd><a href="upgrading_ruby_on_rails.html">Upgrading Ruby on Rails</a></dd>
                  <dd><a href="6_0_release_notes.html">6.0 Release Notes - Agosto 2019</a></dd>
                  <dd><a href="5_2_release_notes.html">Version 5.2 - April 2018</a></dd>
                  <dd><a href="5_1_release_notes.html">Version 5.1 - April 2017</a></dd>
                  <dd><a href="5_0_release_notes.html">Version 5.0 - June 2016</a></dd>
                  <dd><a href="4_2_release_notes.html">Version 4.2 - December 2014</a></dd>
                  <dd><a href="4_1_release_notes.html">Version 4.1 - April 2014</a></dd>
                  <dd><a href="4_0_release_notes.html">Version 4.0 - June 2013</a></dd>
                  <dd><a href="3_2_release_notes.html">Version 3.2 - January 2012</a></dd>
                  <dd><a href="3_1_release_notes.html">Version 3.1 - August 2011</a></dd>
                  <dd><a href="3_0_release_notes.html">Version 3.0 - August 2010</a></dd>
                  <dd><a href="2_3_release_notes.html">Version 2.3 - March 2009</a></dd>
                  <dd><a href="2_2_release_notes.html">Version 2.2 - November 2008</a></dd>
                </div>
            </div>
          </dl>
        </li>
        <li><a class="nav-item" href="contributing_to_ruby_on_rails.html">Contribua</a></li>
        <li class="guides-search guides-search-small">
          <input class="search-box search-box-small nav-item" type="text" placeholder="Digite o termo...">
          <div class="search-results"></div>
          <div class="search-spinner">Aguarde...</div>
        </li>
        <li class="guides-index guides-index-small">
          <select class="guides-index-item nav-item">
            <option value="index.html">Guias</option>
              <optgroup label="Comece aqui">
                  <option value="getting_started.html">Começando com Rails</option>
              </optgroup>
              <optgroup label="Models">
                  <option value="active_record_basics.html">Active Record Basics</option>
                  <option value="active_record_migrations.html">Active Record Migrations</option>
                  <option value="active_record_validations.html">Active Record Validations</option>
                  <option value="active_record_callbacks.html">Active Record Callbacks</option>
                  <option value="association_basics.html">Active Record Associations</option>
                  <option value="active_record_querying.html">Active Record Query Interface</option>
                  <option value="active_model_basics.html">Active Model Basics</option>
              </optgroup>
              <optgroup label="Views">
                  <option value="action_view_overview.html">Action View Overview</option>
                  <option value="layouts_and_rendering.html">Layouts and Rendering in Rails</option>
                  <option value="form_helpers.html">Action View Form Helpers</option>
              </optgroup>
              <optgroup label="Controllers">
                  <option value="action_controller_overview.html">Action Controller Overview</option>
                  <option value="routing.html">Rails Routing from the Outside In</option>
              </optgroup>
              <optgroup label="Outros componentes">
                  <option value="active_support_core_extensions.html">Active Support Core Extensions</option>
                  <option value="action_mailer_basics.html">Action Mailer Basics</option>
                  <option value="action_mailbox_basics.html">Action Mailbox Basics</option>
                  <option value="action_text_overview.html">Action Text Overview</option>
                  <option value="active_job_basics.html">Active Job Basics</option>
                  <option value="active_storage_overview.html">Active Storage Overview</option>
                  <option value="action_cable_overview.html">Action Cable Overview</option>
              </optgroup>
              <optgroup label="Indo mais fundo">
                  <option value="i18n.html">Rails Internationalization (I18n) API</option>
                  <option value="testing.html">Testing Rails Applications</option>
                  <option value="security.html">Securing Rails Applications</option>
                  <option value="debugging_rails_applications.html">Debugging Rails Applications</option>
                  <option value="configuring.html">Configuring Rails Applications</option>
                  <option value="command_line.html">The Rails Command Line</option>
                  <option value="asset_pipeline.html">The Asset Pipeline</option>
                  <option value="working_with_javascript_in_rails.html">Working with JavaScript in Rails</option>
                  <option value="initialization.html">The Rails Initialization Process</option>
                  <option value="autoloading_and_reloading_constants.html">Autoloading and Reloading Constants (Zeitwerk Mode)</option>
                  <option value="autoloading_and_reloading_constants_classic_mode.html">Autoloading and Reloading Constants (Classic Mode)</option>
                  <option value="caching_with_rails.html">Caching with Rails: An Overview</option>
                  <option value="active_support_instrumentation.html">Active Support Instrumentation</option>
                  <option value="api_app.html">Using Rails for API-only Applications</option>
                  <option value="active_record_postgresql.html">Active Record and PostgreSQL</option>
                  <option value="active_record_multiple_databases.html">Multiple Databases with Active Record</option>
              </optgroup>
              <optgroup label="Estendendo o Rails">
                  <option value="plugins.html">The Basics of Creating Rails Plugins</option>
                  <option value="rails_on_rack.html">Rails on Rack</option>
                  <option value="generators.html">Creating and Customizing Rails Generators &amp; Templates</option>
                  <option value="engines.html">Getting Started with Engines</option>
                  <option value="threading_and_code_execution.html">Threading and Code Execution in Rails</option>
              </optgroup>
              <optgroup label="Contribuições">
                  <option value="contributing_to_ruby_on_rails.html">Contributing to Ruby on Rails</option>
                  <option value="api_documentation_guidelines.html">API Documentation Guidelines</option>
                  <option value="ruby_on_rails_guides_guidelines.html">Ruby on Rails Guides Guidelines</option>
              </optgroup>
              <optgroup label="Políticas">
                  <option value="maintenance_policy.html">Maintenance Policy for Ruby on Rails</option>
              </optgroup>
              <optgroup label="Release Notes">
                  <option value="upgrading_ruby_on_rails.html">Upgrading Ruby on Rails</option>
                  <option value="6_0_release_notes.html">6.0 Release Notes - Agosto 2019</option>
                  <option value="5_2_release_notes.html">Version 5.2 - April 2018</option>
                  <option value="5_1_release_notes.html">Version 5.1 - April 2017</option>
                  <option value="5_0_release_notes.html">Version 5.0 - June 2016</option>
                  <option value="4_2_release_notes.html">Version 4.2 - December 2014</option>
                  <option value="4_1_release_notes.html">Version 4.1 - April 2014</option>
                  <option value="4_0_release_notes.html">Version 4.0 - June 2013</option>
                  <option value="3_2_release_notes.html">Version 3.2 - January 2012</option>
                  <option value="3_1_release_notes.html">Version 3.1 - August 2011</option>
                  <option value="3_0_release_notes.html">Version 3.0 - August 2010</option>
                  <option value="2_3_release_notes.html">Version 2.3 - March 2009</option>
                  <option value="2_2_release_notes.html">Version 2.2 - November 2008</option>
              </optgroup>
          </select>
        </li>
      </ul>
    </div>
  </div>
  <hr class="hide" />

  <div id="feature">
    <div class="wrapper">
      <h2>Começando com Rails</h2><p>Este guia aborda a instalação e a execução do Ruby on Rails.</p><p>Depois de ler este guia, você vai saber:</p>
<ul>
<li>Como instalar o Rails, criar uma nova aplicação Rails e conectar sua
aplicação com um banco de dados.</li>
<li>A estrutura geral de uma aplicação Rails.</li>
<li>Os princípios básicos do MVC (<strong>Model</strong>, <strong>View</strong>, <strong>Controller</strong>) e design <strong>RESTful</strong>.</li>
<li>Como gerar rapidamente as peças iniciais de uma aplicação Rails.</li>
</ul>


                <div id="subCol">
            <h3 class="chapter"><img src="images/chapters_icon.gif" alt="" />Chapters</h3>
            <ol class="chapters">
<li><a href="#premissas-do-guia">Premissas do Guia</a></li>
<li><a href="#o-que-e-o-rails-questionmark">O que é o Rails?</a></li>
<li>
<a href="#criando-um-novo-projeto-em-rails">Criando um Novo Projeto em Rails</a>

<ul>
<li><a href="#criando-um-novo-projeto-em-rails-instalando-o-rails">Instalando o Rails</a></li>
<li><a href="#criando-a-aplicacao-blog">Criando a Aplicação Blog</a></li>
</ul>
</li>
<li>
<a href="#ola-rails-bang">Olá, Rails!</a>

<ul>
<li><a href="#inicializando-o-servidor-web">Inicializando o Servidor Web</a></li>
<li><a href="#diga-ola-rails">Diga "Olá", Rails</a></li>
<li><a href="#configuracao-da-pagina-inicial-da-aplicacao">Configuração da Página Inicial da Aplicação</a></li>
</ul>
</li>
<li>
<a href="#mvc-and-you">MVC and You</a>

<ul>
<li><a href="#generating-a-model">Generating a Model</a></li>
<li><a href="#database-migrations">Database Migrations</a></li>
<li><a href="#using-a-model-to-interact-with-the-database">Using a Model to Interact with the Database</a></li>
<li><a href="#showing-a-list-of-articles">Showing a List of Articles</a></li>
</ul>
</li>
<li>
<a href="#crudit-where-crudit-is-due">CRUDit Where CRUDit Is Due</a>

<ul>
<li><a href="#showing-a-single-article">Showing a Single Article</a></li>
<li><a href="#resourceful-routing">Resourceful Routing</a></li>
<li><a href="#creating-a-new-article">Creating a New Article</a></li>
<li><a href="#updating-an-article">Updating an Article</a></li>
<li><a href="#deleting-an-article">Deleting an Article</a></li>
</ul>
</li>
<li>
<a href="#adicionando-um-segundo-model">Adicionando um Segundo Model</a>

<ul>
<li><a href="#gerando-um-model">Gerando um Model</a></li>
<li><a href="#associando-models">Associando Models</a></li>
<li><a href="#adicionando-a-rota-para-comentarios">Adicionando a Rota para Comentários</a></li>
<li><a href="#gerando-um-controller">Gerando um Controller</a></li>
</ul>
</li>
<li>
<a href="#refatorando">Refatorando</a>

<ul>
<li><a href="#renderizando-colecoes-de-partials">Renderizando Coleções de <em>Partials</em></a></li>
<li><a href="#renderizando-um-formulario-com-partial">Renderizando um Formulário com <em>Partial</em></a></li>
<li><a href="#usando-concerns">Usando <em>Concerns</em></a></li>
</ul>
</li>
<li>
<a href="#deletando-comentarios">Deletando Comentários</a>

<ul>
<li><a href="#excluindo-objetos-associados">Excluindo objetos associados</a></li>
</ul>
</li>
<li>
<a href="#seguranca">Segurança</a>

<ul>
<li><a href="#autenticacao-basica">Autenticação Básica</a></li>
<li><a href="#outras-consideracoes-de-seguranca">Outras Considerações de Segurança</a></li>
</ul>
</li>
<li><a href="#o-que-vem-depois-questionmark">O que vem depois?</a></li>
<li><a href="#dicas-de-configuracao">Dicas de Configuração</a></li>
</ol>

          </div>

    </div>
  </div>

  <div id="container">
    <div class="wrapper">
      <div id="mainCol">
        <h3 id="premissas-do-guia"><a class="anchorlink" href="#premissas-do-guia">1 Premissas do Guia</a></h3><p>Este guia é projetado para iniciantes que desejam começar uma aplicação Rails do
zero. Ele não assume que você tenha nenhuma experiência anterior com Rails.</p><p>O Rails é um <em>framework</em> para aplicações web que é executado em cima da linguagem
de programação Ruby. Se você não tem nenhuma experiência com Ruby, você vai
achar a curva de aprendizado bastante íngrime começando direto com Rails.
Existem diversas listas organizadas de materiais online para aprender Ruby:</p>
<ul>
<li><a href="https://www.ruby-lang.org/en/documentation/">Site Oficial da Linguagem de Programação Ruby (Em inglês)</a></li>
<li><a href="https://github.com/EbookFoundation/free-programming-books/blob/master/books/free-programming-books.md#ruby">Lista de Livros Grátis de Programação (Em inglês)</a></li>
</ul>
<p>Fique atento que alguns materiais, apesar de excelentes, envolvem versões antigas
do Ruby e podem não incluir parte da sintaxe que você
vai ver no seu dia-a-dia desenvolvendo com Rails.</p><h3 id="o-que-e-o-rails-questionmark"><a class="anchorlink" href="#o-que-e-o-rails-questionmark">2 O que é o Rails?</a></h3><p>Rails é um <em>framework</em> de desenvolvimento de aplicações <em>web</em> escrito na linguagem de programação Ruby.
Foi projetado para facilitar o desenvolvimento de aplicações <em>web</em>, criando premissas sobre tudo que uma pessoa desenvolvedora precisa para começar. Permite que você escreva menos código, enquanto realiza mais do que em muitas outras linguagens ou <em>frameworks.</em> Pessoas desenvolvedoras experientes em Rails, também dizem que desenvolver aplicações web ficou mais divertido.</p><p>Rails é um software opinativo. Assumindo que há uma "melhor" maneira para fazer as coisas, e foi projetado para encorajar essa maneira - e, em alguns casos para desencorajar alternativas. Se você aprender o "Rails Way", provavelmente terá um grande aumento de produtividade. Se você insistir nos velhos hábitos de outras linguagens, tentando usar os padrões que você aprendeu em outro lugar, você pode ter uma experiência menos feliz.</p><p>A filosofia do Rails possui dois princípios fundamentais:</p>
<ul>
<li>
<strong>Não repita a si mesmo:</strong> DRY (don't repeat yourself) é um conceito de desenvolvimento de software que estabelece que "Todo conhecimento deve possuir uma representação única, de autoridade e livre de ambiguidades em todo o sistema". Ao não escrever as mesmas informações repetidamente, o código fica mais fácil de manter, de expandir e com menos <em>bugs</em>.</li>
<li>
<strong>Convenção sobre configuração:</strong> O Rails possui convenções sobre as melhores maneiras de fazer muitas coisas em uma aplicação web, devido a essas convenções você não precisa especificar detalhes através de arquivos de configuração infinitos.</li>
</ul>
<h3 id="criando-um-novo-projeto-em-rails"><a class="anchorlink" href="#criando-um-novo-projeto-em-rails">3 Criando um Novo Projeto em Rails</a></h3><p>A melhor forma de ler esse guia é seguir o passo à passo. Todos os passos são
essenciais para rodar a aplicação de exemplo e nenhum código ou passos adicionais
serão necessários.</p><p>Seguindo este guia, você irá criar um projeto em <em>Rails</em> chamado de
<code>blog</code>, um <em>weblog</em> (muito) simples. Antes de você começar a construir a aplicação,
você precisa ter certeza de ter o <em>Rails</em> instalado.</p><div class="note"><p>Os exemplos à seguir usam <code>$</code> para representar seu <em>prompt</em> de terminal em um
sistema operacional baseado em UNIX, mesmo que ele tenha sido customizado para parecer diferente.
Se você está utilizando Windows, seu <em>prompt</em> será parecido com algo como <code>C:\source_code&gt;</code>.</p></div><h4 id="criando-um-novo-projeto-em-rails-instalando-o-rails"><a class="anchorlink" href="#criando-um-novo-projeto-em-rails-instalando-o-rails">3.1 Instalando o Rails</a></h4><p>Antes de você instalar o Rails, você deve validar para ter certeza que seu sistema
tem os pré requisitos necessários instalados. Esses incluem:</p>
<ul>
<li>Ruby </li>
<li>SQLite3</li>
<li>Node.js</li>
<li>Yarn</li>
</ul>
<h5 id="instalando-o-ruby"><a class="anchorlink" href="#instalando-o-ruby">3.1.1 Instalando o Ruby</a></h5><p>Abra o <em>prompt</em> de linha de comando. No <em>macOS</em> abra o <em>Terminal.app</em>; no <em>Windows</em>
escolha "Executar" no menu inicial e digite <code>cmd.exe</code>. Qualquer comando que antecede
o sinal de dólar <code>$</code> deverá ser rodado em linha de comando. Verifique se você tem a
versão atual do Ruby instalado:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">ruby</span> <span class="nt">--version</span>
<span class="go">ruby 2.5.0
</span></code></pre>
<textarea class="clipboard-content" id="clipboard-7c952f01f841c9b6d56d89ea5e3e4bfc">ruby --version
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-7c952f01f841c9b6d56d89ea5e3e4bfc">Copiar</button>
</div>
<p>O Rails necessita da versão Ruby 2.5.0 ou mais atual. Se o número da versão retornada
for menor que este número (como 2.3.7, e 1.8.7), você precisará instalar uma versão do Ruby mais atual.</p><p>Para instalar o Rails no Windows, você primeiro tem que instalar o <a href="https://rubyinstaller.org">Ruby Installer</a>. </p><p>Para mais informações de instalação
de outros Sistemas Operacionais, dê uma olhada em <a href="https://www.ruby-lang.org/en/documentation/installation/">ruby-lang.org</a>.</p><h5 id="instalando-o-sqlite3"><a class="anchorlink" href="#instalando-o-sqlite3">3.1.2 Instalando o SQLite3</a></h5><p>Você também precisará instalar o banco de dados SQLite3.
Muitos sistemas operacionais populares semelhantes ao UNIX são fornecidos com uma versão compatível do SQLite3.
Em outros sistemas você pode achar mais instruções de instalação em <a href="https://www.sqlite.org">SQLite3 website</a>.
Verifique se está corretamente instalado e carregado no seu <code>PATH</code>:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">sqlite3</span> <span class="nt">--version</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8e6ba6845e5b9c4d7d028d6850cb68fa">sqlite3 --version
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8e6ba6845e5b9c4d7d028d6850cb68fa">Copiar</button>
</div>
<p>O programa deverá reportar sua versão.</p><h5 id="instalando-o-node-js-e-yarn"><a class="anchorlink" href="#instalando-o-node-js-e-yarn">3.1.3 Instalando o Node.js e Yarn</a></h5><p>Por fim, você precisará do Node.js e o Yarn instalados para gerenciar o JavaScript da sua aplicação.</p><p>Encontre as instruções de instalação no <a href="https://nodejs.org/en/download/">site do Node.js</a> e
verifique se está instalado corretamente com o seguinte comando:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">node</span> <span class="nt">--version</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8719bb141e03c26a160694feec2a58bc">node --version
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8719bb141e03c26a160694feec2a58bc">Copiar</button>
</div>
<p>A versão do Node.js deve ser impressa. Certifique-se de que é maior
que 8.16.0.</p><p>Para instalar o Yarn, siga as instruções de instalação
instruções no <a href="https://classic.yarnpkg.com/en/docs/install">site do Yarn</a>.</p><p>A execução deste comando deve imprimir a versão do Yarn:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">yarn</span> <span class="nt">--version</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-b4acab99a675b9c74fa847ab48235071">yarn --version
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-b4acab99a675b9c74fa847ab48235071">Copiar</button>
</div>
<p>Se aparecer algo como "1.22.0", o Yarn foi instalado corretamente.</p><h5 id="criando-um-novo-projeto-em-rails-instalando-o-rails-instalando-o-rails"><a class="anchorlink" href="#criando-um-novo-projeto-em-rails-instalando-o-rails-instalando-o-rails">3.1.4 Instalando o Rails</a></h5><p>Para instalar o Rails, use o comando <code>gem install</code> fornecido pelo RubyGems:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">gem install rails</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-3cb25deae49e8f74d5ab63da75522f0f">gem install rails
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-3cb25deae49e8f74d5ab63da75522f0f">Copiar</button>
</div>
<p>Para verificar se você tem tudo instalado corretamente, você deve rodar o comando à seguir:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails</span> <span class="nt">--version</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-c2c3e93dad80d068b11976f0a5316ebe">rails --version
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-c2c3e93dad80d068b11976f0a5316ebe">Copiar</button>
</div>
<p>Se esse comando retornar algo como "Rails 6.0.0", você está pronto para continuar.</p><h4 id="criando-a-aplicacao-blog"><a class="anchorlink" href="#criando-a-aplicacao-blog">3.2 Criando a Aplicação Blog</a></h4><p>O Rails vem com vários scripts chamados <em>generators</em> que são projetados para tornar
sua vida de desenvolvedor fácil, criando tudo que é necessário para começar a
trabalhar em uma tarefa em particular. Um desses é o <em>generator</em> de nova aplicação,
que irá te fornecer a base de uma nova aplicação em Rails para que você não precise
escrever tudo sozinho.</p><p>Para utilizar esse <em>generator</em>, abra um terminal, navegue para um diretório onde
você tenha permissão para criar arquivos, e rode:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">rails </span>new blog
</code></pre>
<textarea class="clipboard-content" id="clipboard-8ffb854801520d81843c3acb852e9064">rails new blog
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8ffb854801520d81843c3acb852e9064">Copiar</button>
</div>
<p>Este comando irá criar uma aplicação em Rails chamada Blog em um diretório <code>blog</code>
e irá instalar as dependências das <em>gems</em> que já foram mencionadas no <code>Gemfile</code>
usando <code>bundle install</code>.</p><div class="note"><p>Se você está utilizando um subsistema Windows para Linux então existem
algumas limitações nas notificações dos arquivos do sistema que significa que você
deve desabilitar as gems <code>spring</code> e <code>listen</code>, o que poderá ser feito rodando o comando
<code>rails new blog --skip-spring --skip-listen</code>.</p></div><div class="info"><p>Você pode ver todas as opções de linha de comando gerador que a aplicação Rails
aceita rodando o comando <code>rails new --help</code>.</p></div><p>Depois de criar a aplicação blog, entre em sua pasta:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">cd </span>blog
</code></pre>
<textarea class="clipboard-content" id="clipboard-d35f60570ba0e73a7bafca8d18c01fd9">cd blog
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d35f60570ba0e73a7bafca8d18c01fd9">Copiar</button>
</div>
<p>A pasta <code>blog</code> vai ter vários arquivos gerados e pastas que compõem a estrutura
de uma aplicação Rails. A maior parte da execução deste tutorial será feito na
pasta <code>app</code>, mas à seguir teremos um resumo básico das funções de cada um dos arquivos e pastas
que o Rails gerou por padrão:</p>
<table>
<thead>
<tr>
<th>Arquivo/Pasta</th>
<th>Objetivo</th>
</tr>
</thead>
<tbody>
<tr>
<td>app/</td>
<td>Contém os <em>controllers</em>, <em>models</em>, <em>views</em>, <em>helpers</em>, <em>mailers</em>, <em>channels</em>, <em>jobs</em>, e <em>assets</em> para sua aplicação. Você irá se concentrar nesse diretório pelo restante desse guia.</td>
</tr>
<tr>
<td>bin/</td>
<td>Contém o script <code>rails</code> que inicializa sua aplicação e contém outros scripts que você utiliza para configurar, atualizar, colocar em produção ou executar sua aplicação.</td>
</tr>
<tr>
<td>config/</td>
<td>Contém configurações de rotas, banco de dados entre outros de sua aplicação. Este conteúdo é abordado com mais detalhes em <a href="configuring.html">Configuring Rails Applications</a>.</td>
</tr>
<tr>
<td>config.ru</td>
<td>Configuração <em>Rack</em> para servidores baseados em <em>Rack</em> usados para iniciar a aplicação. Para mais informações sobre o <em>Rack</em>, consulte <a href="https://rack.github.io/">Rack website</a>.</td>
</tr>
<tr>
<td>db/</td>
<td>Contém o <em>schema</em> do seu banco de dados atual, assim como as <em>migrations</em> do banco de dados.</td>
</tr>
<tr>
<td>Gemfile<br>Gemfile.lock</td>
<td>Esses arquivos permitem que você especifique quais dependências de <em>gem</em> são necessárias na sua aplicação Rails. Esses arquivos são usados pela <em>gem</em> Bundler. Para mais informações sobre o Bundler, acesse <a href="https://bundler.io">o website do Bundler</a>.</td>
</tr>
<tr>
<td>lib/</td>
<td>Módulos extendidos da sua aplicação.</td>
</tr>
<tr>
<td>log/</td>
<td>Arquivos de <em>log</em> da aplicação.</td>
</tr>
<tr>
<td>package.json</td>
<td>Este arquivo permite que você especifique quais dependências <em>npm</em> são necessárias para sua aplicação Rails. Este arquivo é usado pelo Yarn. Para mais informações do Yarn, acesse <a href="https://yarnpkg.com/lang/en/">o website do Yarn</a>.</td>
</tr>
<tr>
<td>public/</td>
<td>Contém arquivos estáticos e <em>assets</em> compilados. Quando sua aplicação está rodando esse diretório é exposto como ele está.</td>
</tr>
<tr>
<td>Rakefile</td>
<td>Este arquivo localiza e carrega tarefas que podem ser rodadas por linhas de comando. As tarefas são definidas nos componentes do Rails. Ao invés de editar o <code>Rakefile</code>, você deve criar suas próprias tarefas adicionando os arquivos no diretório <code>lib/tasks</code> da sua aplicação.</td>
</tr>
<tr>
<td>README.md</td>
<td>Este é um manual de instruções para sua aplicação. Você deve editar este arquivo para informar o que seu aplicativo faz, como configurá-lo e assim por diante.</td>
</tr>
<tr>
<td>storage/</td>
<td>Arquivos de armazenamento ativo do serviço de disco. Mais informações em <a href="active_storage_overview.html">Active Storage Overview</a>.</td>
</tr>
<tr>
<td>test/</td>
<td>Testes unitários, <em>fixtures</em>, e outros tipos de testes. Mais informações em <a href="testing.html">Testing Rails Applications</a>.</td>
</tr>
<tr>
<td>tmp/</td>
<td>Arquivos temporários (como cache e arquivos <em>pid</em>).</td>
</tr>
<tr>
<td>vendor/</td>
<td>Diretório com todos os códigos de terceiros. Em uma típica aplicação Rails inclui <em>vendored gems</em>.</td>
</tr>
<tr>
<td>.gitignore</td>
<td>Este arquivo diz ao Git quais arquivos (ou padrões) devem ser ignorados. Acesse <a href="https://help.github.com/articles/ignoring-files">GitHub - Ignoring files</a> para mais informações sobre arquivos ignorados.</td>
</tr>
<tr>
<td>.ruby-version</td>
<td>Este arquivo contém a versão padrão do Ruby.</td>
</tr>
</tbody>
</table>
<h3 id="ola-rails-bang"><a class="anchorlink" href="#ola-rails-bang">4 Olá, Rails!</a></h3><p>Para começar vamos colocar um texto na tela rapidamente. Para fazer isso, você
precisa que seu servidor de aplicação Rails esteja em execução.</p><h4 id="inicializando-o-servidor-web"><a class="anchorlink" href="#inicializando-o-servidor-web">4.1 Inicializando o Servidor Web</a></h4><p>Você já tem uma aplicação Rails funcional. Para vê-la você deve iniciar um
servidor web em sua máquina de desenvolvimento. Você pode fazer isso executando
o seguinte comando no diretório <code>blog</code>:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>server
</code></pre>
<textarea class="clipboard-content" id="clipboard-8c35c27e510516098b95f2fbbe8c3df6">bin/rails server
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8c35c27e510516098b95f2fbbe8c3df6">Copiar</button>
</div>
<div class="info"><p>Se você está usando Windows, deve executar os scripts do diretório
<code>bin</code> para o interpretador do Ruby: <code>ruby bin\rails server</code>.</p></div><div class="info"><p>A compressão de <em>assets</em> JavaScript requer que você tenha um executor
disponível em seu sistema operacional. Na ausência de um executor você verá um
erro de <code>execjs</code> durante a compressão dos <em>assets</em>. Geralmente o macOS e o Windows possuem um executor JavaScript instalado por
padrão. <code>therubyrhino</code> é o executor recomendado para usuários de JRuby e vem no
<code>Gemfile</code> por padrão em aplicações geradas com JRuby. Você pode avaliar todos
executores em <a href="https://github.com/rails/execjs#readme">ExecJS</a>.</p></div><p>A execução do comando irá iniciar o Puma, um servidor web distribuído com o
Rails por padrão. Para ver sua aplicação em execução, abra um navegador e
navegue para <a href="http://localhost:3000">http://localhost:3000</a>.  Você deve ver a página padrão com informações do Rails:</p><p><img src="images/getting_started/rails_welcome.png" alt="Captura de tela escrito Yay! Você está no Rails(em inglês)"></p><p>Quando você deseja interromper a execução do servidor Web, pressione Ctrl+C na janela do
terminal em que o servidor está sendo executado. No ambiente de desenvolvimento, o Rails geralmente não requer que você reinicie o servidor; mudanças em arquivos são automaticamente interpretadas pelo servidor.</p><p>A página de "Yay! Você está no Rails! (Yay! You're on Rails!)" é o <em>smoke test</em> (teste de sanidade) para uma
nova aplicação Rails: garante que o seu software esteja configurado
corretamente, o suficiente para gerar uma página.</p><h4 id="diga-ola-rails"><a class="anchorlink" href="#diga-ola-rails">4.2 Diga "Olá", Rails</a></h4><p>Para que o Rails diga "Olá", você precisa criar no mínimo uma rota (<em>route</em>), um <em>controller</em> com uma <em>action</em> e uma <em>view</em>. A <em>route</em> mapeia uma requisição para uma <em>action</em> de um <em>controller</em>. A <em>action</em> do <em>controller</em> faz todo o trabalho necessário para lidar com a requisição, e prepara qualquer dado para a <em>view</em>. A <em>view</em>  mostra o dado no formato que você quiser.</p><p>Em termos de implementação: Rotas são regras escritas em um <a href="https://pt.wikipedia.org/wiki/Linguagem_de_dom%C3%ADnio_espec%C3%ADfico">DSL (domain-specific language)</a> em Ruby. <em>Controllers</em> são classes Ruby, e seus métodos públicos são as <em>actions</em>. E as <em>views</em> são <em>templates</em>, geralmente escritos numa mistura de Ruby e HTML.</p><p>Vamos começar adicionando uma rota ao nosso arquivo de rotas, <code>config/routes.rb</code>, no
topo do bloco <code>Rails.application.routes.draw</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#index"</span>

  <span class="c1"># Para mais detalhes da DSL disponível para esse arquivo, veja https://guides.rubyonrails.org/routing.html</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-c785c6b5e683895d74d27dbf9a1fae8b">Rails.application.routes.draw do
  get "/articles", to: "articles#index"

  # Para mais detalhes da DSL disponível para esse arquivo, veja https://guides.rubyonrails.org/routing.html
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-c785c6b5e683895d74d27dbf9a1fae8b">Copiar</button>
</div>
<p>A rota acima declara que as requisições de <code>GET / articles</code> são mapeadas para o <em>action</em> <code>index</code> do <code>ArticlesController</code>.</p><p>Para criar o <code>ArticlesController</code> e sua <em>action</em> <code>index</code>, vamos executar o controlador
gerador (com a opção <code>--skip-routes</code> porque já temos um
rota apropriada):</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate controller Articles index <span class="nt">--skip-routes</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8bd8ca24ecc902bda7012893f4ae62ad">bin/rails generate controller Articles index --skip-routes
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8bd8ca24ecc902bda7012893f4ae62ad">Copiar</button>
</div>
<p>O Rails vai gerar vários arquivos para você:</p><div class="code_container">
<pre><code class="highlight plaintext">create  app/controllers/articles_controller.rb
invoke  erb
create    app/views/articles
create    app/views/articles/index.html.erb
invoke  test_unit
create    test/controllers/articles_controller_test.rb
invoke  helper
create    app/helpers/articles_helper.rb
invoke    test_unit
invoke  assets
invoke    scss
create      app/assets/stylesheets/articles.scss
</code></pre>
<textarea class="clipboard-content" id="clipboard-1a11d9cb13c4f39d37e86336c0d4bbcb">create  app/controllers/articles_controller.rb
invoke  erb
create    app/views/articles
create    app/views/articles/index.html.erb
invoke  test_unit
create    test/controllers/articles_controller_test.rb
invoke  helper
create    app/helpers/articles_helper.rb
invoke    test_unit
invoke  assets
invoke    scss
create      app/assets/stylesheets/articles.scss
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-1a11d9cb13c4f39d37e86336c0d4bbcb">Copiar</button>
</div>
<p>Os mais importante desses é o arquivo <em>controller</em>, <code>app/controllers/welcome_controller.rb</code>. Vamos dar uma olhada nele:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-70da9df1be9adec999d080455f95f5db">class ArticlesController &lt; ApplicationController
  def index
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-70da9df1be9adec999d080455f95f5db">Copiar</button>
</div>
<p>A <em>action</em> <code>index</code> está vazia. Quando uma <em>action</em> não renderiza explicitamente uma <em>view</em>
(ou de outra forma acionar uma resposta HTTP), o Rails irá renderizar automaticamente uma <em>view</em>
que corresponde ao nome do <em>controller</em> e <em>action</em>. Convenção sobre
Configuração! As <em>views</em> estão localizadas no diretório <code>app/views</code>. Portanto, a <em>action</em> <code>index</code> renderizará <code>app/views/articles/index.html.erb</code> por padrão.</p><p>Vamos abrir o arquivo <code>app/views/articles/index.html.erb</code>, e substituir todo código existente por:</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;h1&gt;</span>Olá, Rails!<span class="nt">&lt;/h1&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2a4c5c03e367e33142b5540d78c7d96a">&lt;h1&gt;Olá, Rails!&lt;/h1&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2a4c5c03e367e33142b5540d78c7d96a">Copiar</button>
</div>
<p>Se você parou anteriormente o servidor web para executar o gerador do <em>controller</em>,
reinicie-o com <code>bin/rails server</code>. Agora visite <a href="http://localhost:3000/articles">http://localhost:3000/articles</a>
e veja nosso texto exibido!</p><h4 id="configuracao-da-pagina-inicial-da-aplicacao"><a class="anchorlink" href="#configuracao-da-pagina-inicial-da-aplicacao">4.3 Configuração da Página Inicial da Aplicação</a></h4><p>No momento, <a href="http://localhost:3000">http://localhost:3000</a> ainda exibe "Yay! Você está no Rails!".
Vamos mostrar nosso "Olá, Rails!" texto em <a href="http://localhost:3000">http://localhost:3000</a> também.
Para fazer isso, vamos adicionar uma rota que mapeia o caminho raiz (<em>root path</em>) da nossa aplicação para o <em>controller</em> e <em>action</em> apropriados.</p><p>Vamos abrir o arquivo <code>config/routes.rb</code>, e adicionar o a rota <code>root</code> no começo do bloco <code>Rails.application.routes.draw</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s2">"articles#index"</span>

  <span class="n">get</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#index"</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8edc6913f3ba933d700d770d2adbf9bc">Rails.application.routes.draw do
  root "articles#index"

  get "/articles", to: "articles#index"
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8edc6913f3ba933d700d770d2adbf9bc">Copiar</button>
</div>
<p>Agora podemos ver a mensagem "Olá, Rails!", quando visitamos <a href="http://localhost:3000">http://localhost:3000</a> confirmando que a <em>route</em> <code>root</code> também mapeia para a <em>action</em> <code>index</code> de <code>ArticlesController</code>.</p><div class="info"><p>Para mais informações sobre roteamento, consulte <a href="routing.html">Roteamento do Rails de Fora para Dentro</a>.</p></div><h3 id="mvc-and-you"><a class="anchorlink" href="#mvc-and-you">5 MVC and You</a></h3><p>So far, we've discussed routes, controllers, actions, and views. All of these
are typical pieces of a web application that follows the <a href="https://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller">MVC (Model-View-Controller)</a> pattern.
MVC is a design pattern that divides the responsibilities of an application to
make it easier to reason about. Rails follows this design pattern by convention.</p><p>Since we have a controller and a view to work with, let's generate the next
piece: a model.</p><h4 id="generating-a-model"><a class="anchorlink" href="#generating-a-model">5.1 Generating a Model</a></h4><p>A <em>model</em> is a Ruby class that is used to represent data. Additionally, models
can interact with the application's database through a feature of Rails called
<em>Active Record</em>.</p><p>To define a model, we will use the model generator:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate model Article title:string body:text
</code></pre>
<textarea class="clipboard-content" id="clipboard-656c23548ce51e8717ea4ea6c8d5a5a9">bin/rails generate model Article title:string body:text
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-656c23548ce51e8717ea4ea6c8d5a5a9">Copiar</button>
</div>
<div class="note"><p>Model names are <strong>singular</strong>, because an instantiated model represents a
single data record. To help remember this convention, think of how you would
call the model's constructor: we want to write <code>Article.new(...)</code>, <strong>not</strong>
<code>Articles.new(...)</code>.</p></div><p>This will create several files:</p><div class="code_container">
<pre><code class="highlight plaintext">invoke  active_record
create    db/migrate/&lt;timestamp&gt;_create_articles.rb
create    app/models/article.rb
invoke    test_unit
create      test/models/article_test.rb
create      test/fixtures/articles.yml
</code></pre>
<textarea class="clipboard-content" id="clipboard-bf8a191d881ee7cf82cd61678cb0ad9f">invoke  active_record
create    db/migrate/&lt;timestamp&gt;_create_articles.rb
create    app/models/article.rb
invoke    test_unit
create      test/models/article_test.rb
create      test/fixtures/articles.yml
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-bf8a191d881ee7cf82cd61678cb0ad9f">Copiar</button>
</div>
<p>The two files we'll focus on are the migration file
(<code>db/migrate/&lt;timestamp&gt;_create_articles.rb</code>) and the model file
(<code>app/models/article.rb</code>).</p><h4 id="database-migrations"><a class="anchorlink" href="#database-migrations">5.2 Database Migrations</a></h4><p><em>Migrations</em> are used to alter the structure of an application's database. In
Rails applications, migrations are written in Ruby so that they can be
database-agnostic.</p><p>Let's take a look at the contents of our new migration file:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">CreateArticles</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">6.0</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:articles</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:title</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">text</span> <span class="ss">:body</span>

      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-162102ec79a778392b4a7725e98cf914">class CreateArticles &lt; ActiveRecord::Migration[6.0]
  def change
    create_table :articles do |t|
      t.string :title
      t.text :body

      t.timestamps
    end
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-162102ec79a778392b4a7725e98cf914">Copiar</button>
</div>
<p>The call to <code>create_table</code> specifies how the <code>articles</code> table should be
constructed. By default, the <code>create_table</code> method adds an <code>id</code> column as an
auto-incrementing primary key. So the first record in the table will have an
<code>id</code> of 1, the next record will have an <code>id</code> of 2, and so on.</p><p>Inside the block for <code>create_table</code>, two columns are defined: <code>title</code> and
<code>body</code>. These were added by the generator because we included them in our
generate command (<code>bin/rails generate model Article title:string body:text</code>).</p><p>On the last line of the block is a call to <code>t.timestamps</code>. This method defines
two additional columns named <code>created_at</code> and <code>updated_at</code>. As we will see,
Rails will manage these for us, setting the values when we create or update a
model object.</p><p>Let's run our migration with the following command:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>db:migrate
</code></pre>
<textarea class="clipboard-content" id="clipboard-ead8db319202b2318fff2cd81cb2a069">bin/rails db:migrate
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-ead8db319202b2318fff2cd81cb2a069">Copiar</button>
</div>
<p>The command will display output indicating that the table was created:</p><div class="code_container">
<pre><code class="highlight plaintext">==  CreateArticles: migrating ===================================
-- create_table(:articles)
   -&gt; 0.0018s
==  CreateArticles: migrated (0.0018s) ==========================
</code></pre>
<textarea class="clipboard-content" id="clipboard-a16b29da84ee686699d1cb5270cc7478">==  CreateArticles: migrating ===================================
-- create_table(:articles)
   -&gt; 0.0018s
==  CreateArticles: migrated (0.0018s) ==========================
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-a16b29da84ee686699d1cb5270cc7478">Copiar</button>
</div>
<div class="info"><p>To learn more about migrations, see <a href="active_record_migrations.html">Active Record Migrations</a>.</p></div><p>Now we can interact with the table using our model.</p><h4 id="using-a-model-to-interact-with-the-database"><a class="anchorlink" href="#using-a-model-to-interact-with-the-database">5.3 Using a Model to Interact with the Database</a></h4><p>To play with our model a bit, we're going to use a feature of Rails called the
<em>console</em>. The console is an interactive coding environment just like <code>irb</code>, but
it also automatically loads Rails and our application code.</p><p>Let's launch the console with this command:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>console
</code></pre>
<textarea class="clipboard-content" id="clipboard-2287869d4a68e478514f946cffdaa3da">bin/rails console
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2287869d4a68e478514f946cffdaa3da">Copiar</button>
</div>
<p>You should see an <code>irb</code> prompt like:</p><div class="code_container">
<pre><code class="highlight irb"><span class="go">Loading development environment (Rails 6.0.2.1)
</span><span class="gp">irb(main):001:0&gt;</span><span class="w">
</span></code></pre>
<textarea class="clipboard-content" id="clipboard-44dd8b2802870d002b315ca2b2bb6325"></textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-44dd8b2802870d002b315ca2b2bb6325">Copiar</button>
</div>
<p>At this prompt, we can initialize a new <code>Article</code> object:</p><div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">title: </span><span class="s2">"Hello Rails"</span><span class="p">,</span> <span class="ss">body: </span><span class="s2">"I am on Rails!"</span><span class="p">)</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2220127e1de2880587ab4d96336ba71d">article = Article.new(title: "Hello Rails", body: "I am on Rails!")
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2220127e1de2880587ab4d96336ba71d">Copiar</button>
</div>
<p>It's important to note that we have only <em>initialized</em> this object. This object
is not saved to the database at all. It's only available in the console at the
moment. To save the object to the database, we must call <a href="https://api.rubyonrails.org/v6.1.0/classes/ActiveRecord/Persistence.html#method-i-save"><code>save</code></a>:</p><div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">article</span><span class="p">.</span><span class="nf">save</span>
<span class="go">(0.1ms)  begin transaction
Article Create (0.4ms)  INSERT INTO "articles" ("title", "body", "created_at", "updated_at") VALUES (?, ?, ?, ?)  [["title", "Hello Rails"], ["body", "I am on Rails!"], ["created_at", "2020-01-18 23:47:30.734416"], ["updated_at", "2020-01-18 23:47:30.734416"]]
(0.9ms)  commit transaction
</span><span class="p">=&gt;</span> <span class="kp">true</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-ca00c1d0b948dccc2512a7d4b9fe2b0e">article.save
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-ca00c1d0b948dccc2512a7d4b9fe2b0e">Copiar</button>
</div>
<p>The above output shows an <code>INSERT INTO "articles" ...</code> database query. This
indicates that the article has been inserted into our table. And if we take a
look at the <code>article</code> object again, we see something interesting has happened:</p><div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="n">article</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">Article</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">title: </span><span class="s2">"Hello Rails"</span><span class="p">,</span> <span class="ss">body: </span><span class="s2">"I am on Rails!"</span><span class="p">,</span> <span class="ss">created_at: </span><span class="s2">"2020-01-18 23:47:30"</span><span class="p">,</span> <span class="ss">updated_at: </span><span class="s2">"2020-01-18 23:47:30"</span><span class="kt">&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0ac0673155badfd50559144944bdc365">article
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0ac0673155badfd50559144944bdc365">Copiar</button>
</div>
<p>The <code>id</code>, <code>created_at</code>, and <code>updated_at</code> attributes of the object are now set.
Rails did this for us when we saved the object.</p><p>When we want to fetch this article from the database, we can call <a href="https://api.rubyonrails.org/v6.1.0/classes/ActiveRecord/FinderMethods.html#method-i-find"><code>find</code></a>
on the model and pass the <code>id</code> as an argument:</p><div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">Article</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">title: </span><span class="s2">"Hello Rails"</span><span class="p">,</span> <span class="ss">body: </span><span class="s2">"I am on Rails!"</span><span class="p">,</span> <span class="ss">created_at: </span><span class="s2">"2020-01-18 23:47:30"</span><span class="p">,</span> <span class="ss">updated_at: </span><span class="s2">"2020-01-18 23:47:30"</span><span class="kt">&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-38570a5cc1110b0d1a4aaacaf5a93953">Article.find(1)
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-38570a5cc1110b0d1a4aaacaf5a93953">Copiar</button>
</div>
<p>And when we want to fetch all articles from the database, we can call <a href="https://api.rubyonrails.org/v6.1.0/classes/ActiveRecord/Scoping/Named/ClassMethods.html#method-i-all"><code>all</code></a>
on the model:</p><div class="code_container">
<pre><code class="highlight irb"><span class="gp">irb&gt;</span><span class="w"> </span><span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
<span class="p">=&gt;</span> <span class="kt">#&lt;</span><span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Relation</span> <span class="p">[</span><span class="kt">#&lt;</span><span class="no">Article</span> <span class="ss">id: </span><span class="mi">1</span><span class="p">,</span> <span class="ss">title: </span><span class="s2">"Hello Rails"</span><span class="p">,</span> <span class="ss">body: </span><span class="s2">"I am on Rails!"</span><span class="p">,</span> <span class="ss">created_at: </span><span class="s2">"2020-01-18 23:47:30"</span><span class="p">,</span> <span class="ss">updated_at: </span><span class="s2">"2020-01-18 23:47:30"</span><span class="kt">&gt;</span><span class="p">]</span><span class="kt">&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2d51e7ecd2fb84e3eb4c9419ddd0b531">Article.all
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2d51e7ecd2fb84e3eb4c9419ddd0b531">Copiar</button>
</div>
<p>This method returns an <a href="https://api.rubyonrails.org/v6.1.0/classes/ActiveRecord/Relation.html"><code>ActiveRecord::Relation</code></a> object, which
you can think of as a super-powered array.</p><div class="info"><p>To learn more about models, see <a href="active_record_basics.html">Active Record Basics</a> and <a href="active_record_querying.html">Active Record Query Interface</a>.</p></div><p>Models are the final piece of the MVC puzzle. Next, we will connect all of the
pieces together.</p><h4 id="showing-a-list-of-articles"><a class="anchorlink" href="#showing-a-list-of-articles">5.4 Showing a List of Articles</a></h4><p>Let's go back to our controller in <code>app/controllers/articles_controller.rb</code>, and
change the <code>index</code> action to fetch all articles from the database:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-03981e9dec2368a625ed275201e3ff5c">class ArticlesController &lt; ApplicationController
  def index
    @articles = Article.all
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-03981e9dec2368a625ed275201e3ff5c">Copiar</button>
</div>
<p>Controller instance variables can be accessed by the view. That means we can
reference <code>@articles</code> in <code>app/views/articles/index.html.erb</code>. Let's open that
file, and replace its contents with:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0aaff4a9b7d6a3d139db73511e8e6042">&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;li&gt;
      &lt;%= article.title %&gt;
    &lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0aaff4a9b7d6a3d139db73511e8e6042">Copiar</button>
</div>
<p>The above code is a mixture of HTML and <em>ERB</em>. ERB is a templating system that
evaluates Ruby code embedded in a document. Here, we can see two types of ERB
tags: <code>&lt;% %&gt;</code> and <code>&lt;%= %&gt;</code>. The <code>&lt;% %&gt;</code> tag means "evaluate the enclosed Ruby
code." The <code>&lt;%= %&gt;</code> tag means "evaluate the enclosed Ruby code, and output the
value it returns." Anything you could write in a regular Ruby program can go
inside these ERB tags, though it's usually best to keep the contents of ERB tags
short, for readability.</p><p>Since we don't want to output the value returned by <code>@articles.each</code>, we've
enclosed that code in <code>&lt;% %&gt;</code>. But, since we <em>do</em> want to output the value
returned by <code>article.title</code> (for each article), we've enclosed that code in
<code>&lt;%= %&gt;</code>.</p><p>We can see the final result by visiting <a href="http://localhost:3000">http://localhost:3000</a>. (Remember that
<code>bin/rails server</code> must be running!) Here's what happens when we do that:</p>
<ol>
<li>The browser makes a request: <code>GET http://localhost:3000</code>.</li>
<li>Our Rails application receives this request.</li>
<li>The Rails router maps the root route to the <code>index</code> action of <code>ArticlesController</code>.</li>
<li>The <code>index</code> action uses the <code>Article</code> model to fetch all articles in the database.</li>
<li>Rails automatically renders the <code>app/views/articles/index.html.erb</code> view.</li>
<li>The ERB code in the view is evaluated to output HTML.</li>
<li>The server sends a response containing the HTML back to the browser.</li>
</ol>
<p>We've connected all the MVC pieces together, and we have our first controller
action! Next, we'll move on to the second action.</p><h3 id="crudit-where-crudit-is-due"><a class="anchorlink" href="#crudit-where-crudit-is-due">6 CRUDit Where CRUDit Is Due</a></h3><p>Almost all web applications involve <a href="https://en.wikipedia.org/wiki/Create,_read,_update,_and_delete">CRUD (Create, Read, Update, and Delete)</a> operations. You
may even find that the majority of the work your application does is CRUD. Rails
acknowledges this, and provides many features to help simplify code doing CRUD.</p><p>Let's begin exploring these features by adding more functionality to our
application.</p><h4 id="showing-a-single-article"><a class="anchorlink" href="#showing-a-single-article">6.1 Showing a Single Article</a></h4><p>We currently have a view that lists all articles in our database. Let's add a
new view that shows the title and body of a single article.</p><p>We start by adding a new route that maps to a new controller action (which we
will add next). Open <code>config/routes.rb</code>, and insert the last route shown here:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s2">"articles#index"</span>

  <span class="n">get</span> <span class="s2">"/articles"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#index"</span>
  <span class="n">get</span> <span class="s2">"/articles/:id"</span><span class="p">,</span> <span class="ss">to: </span><span class="s2">"articles#show"</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-d9ddfa119d97425306f71bcfc235aa8a">Rails.application.routes.draw do
  root "articles#index"

  get "/articles", to: "articles#index"
  get "/articles/:id", to: "articles#show"
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d9ddfa119d97425306f71bcfc235aa8a">Copiar</button>
</div>
<p>The new route is another <code>get</code> route, but it has something extra in its path:
<code>:id</code>. This designates a route <em>parameter</em>. A route parameter captures a segment
of the request's path, and puts that value into the <code>params</code> Hash, which is
accessible by the controller action. For example, when handling a request like
<code>GET http://localhost:3000/articles/1</code>, <code>1</code> would be captured as the value for
<code>:id</code>, which would then be accessible as <code>params[:id]</code> in the <code>show</code> action of
<code>ArticlesController</code>.</p><p>Let's add that <code>show</code> action now, below the <code>index</code> action in
<code>app/controllers/articles_controller.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-d591b61af0c9d3235f05dbcf558a2b65">class ArticlesController &lt; ApplicationController
  def index
    @articles = Article.all
  end

  def show
    @article = Article.find(params[:id])
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d591b61af0c9d3235f05dbcf558a2b65">Copiar</button>
</div>
<p>The <code>show</code> action calls <code>Article.find</code> (<a href="#using-a-model-to-interact-with-the-database">mentioned
previously</a>) with the ID captured
by the route parameter. The returned article is stored in the <code>@article</code>
instance variable, so it is accessible by the view. By default, the <code>show</code>
action will render <code>app/views/articles/show.html.erb</code>.</p><p>Let's create <code>app/views/articles/show.html.erb</code>, with the following contents:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-1d0f74eac7d8dc3e94b4bba353a393fc">&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-1d0f74eac7d8dc3e94b4bba353a393fc">Copiar</button>
</div>
<p>Now we can see the article when we visit <a href="http://localhost:3000/articles/1">http://localhost:3000/articles/1</a>!</p><p>To finish up, let's add a convenient way to get to an article's page. We'll link
each article's title in <code>app/views/articles/index.html.erb</code> to its page:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/articles/</span><span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">id</span> <span class="cp">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-b02b736d91c1a82b69eb25f036036279">&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;li&gt;
      &lt;a href="/articles/&lt;%= article.id %&gt;"&gt;
        &lt;%= article.title %&gt;
      &lt;/a&gt;
    &lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-b02b736d91c1a82b69eb25f036036279">Copiar</button>
</div>
<h4 id="resourceful-routing"><a class="anchorlink" href="#resourceful-routing">6.2 Resourceful Routing</a></h4><p>So far, we've covered the "R" (Read) of CRUD. We will eventually cover the "C"
(Create), "U" (Update), and "D" (Delete). As you might have guessed, we will do
so by adding new routes, controller actions, and views. Whenever we have such a
combination of routes, controller actions, and views that work together to
perform CRUD operations on an entity, we call that entity a <em>resource</em>. For
example, in our application, we would say an article is a resource.</p><p>Rails provides a routes method named <a href="https://api.rubyonrails.org/v6.1.0/classes/ActionDispatch/Routing/Mapper/Resources.html#method-i-resources"><code>resources</code></a>
that maps all of the conventional routes for a collection of resources, such as
articles. So before we proceed to the "C", "U", and "D" sections, let's replace
the two <code>get</code> routes in <code>config/routes.rb</code> with <code>resources</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s2">"articles#index"</span>

  <span class="n">resources</span> <span class="ss">:articles</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-380ee64869a09c1752b04d8677bd1dfb">Rails.application.routes.draw do
  root "articles#index"

  resources :articles
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-380ee64869a09c1752b04d8677bd1dfb">Copiar</button>
</div>
<p>We can inspect what routes are mapped by running the <code>bin/rails routes</code> command:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>routes
<span class="gp">      Prefix Verb   URI Pattern                  Controller#</span>Action
<span class="gp">        root GET    /                            articles#</span>index
<span class="gp">    articles GET    /articles(.:format)          articles#</span>index
<span class="gp"> new_article GET    /articles/new(.:format)      articles#</span>new
<span class="gp">     article GET    /articles/:id(.:format)      articles#</span>show
<span class="gp">             POST   /articles(.:format)          articles#</span>create
<span class="gp">edit_article GET    /articles/:id/edit(.:format) articles#</span>edit
<span class="gp">             PATCH  /articles/:id(.:format)      articles#</span>update
<span class="gp">             DELETE /articles/:id(.:format)      articles#</span>destroy
</code></pre>
<textarea class="clipboard-content" id="clipboard-d959464c2911910ef0ef7daa3eaf16de">bin/rails routes
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d959464c2911910ef0ef7daa3eaf16de">Copiar</button>
</div>
<p>The <code>resources</code> method also sets up URL and path helper methods that we can use
to keep our code from depending on a specific route configuration. The values
in the "Prefix" column above plus a suffix of <code>_url</code> or <code>_path</code> form the names
of these helpers. For example, the <code>article_path</code> helper returns
<code>"/articles/#{article.id}"</code> when given an article. We can use it to tidy up our
links in <code>app/views/articles/index.html.erb</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"</span><span class="cp">&lt;%=</span> <span class="n">article_path</span><span class="p">(</span><span class="n">article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-4f6aa8aed8bc122cf7e7289a122e1969">&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;li&gt;
      &lt;a href="&lt;%= article_path(article) %&gt;"&gt;
        &lt;%= article.title %&gt;
      &lt;/a&gt;
    &lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-4f6aa8aed8bc122cf7e7289a122e1969">Copiar</button>
</div>
<p>However, we will take this one step further by using the <a href="https://api.rubyonrails.org/v6.1.0/classes/ActionView/Helpers/UrlHelper.html#method-i-link_to"><code>link_to</code></a>
helper. The <code>link_to</code> helper renders a link with its first argument as the
link's text and its second argument as the link's destination. If we pass a
model object as the second argument, <code>link_to</code> will call the appropriate path
helper to convert the object to a path. For example, if we pass an article,
<code>link_to</code> will call <code>article_path</code>. So <code>app/views/articles/index.html.erb</code>
becomes:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span><span class="p">,</span> <span class="n">article</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-4957c484b02779c86da0095383da0c97">&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;li&gt;
      &lt;%= link_to article.title, article %&gt;
    &lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-4957c484b02779c86da0095383da0c97">Copiar</button>
</div>
<p>Nice!</p><div class="info"><p>To learn more about routing, see <a href="routing.html">Rails Routing from the Outside In</a>.</p></div><h4 id="creating-a-new-article"><a class="anchorlink" href="#creating-a-new-article">6.3 Creating a New Article</a></h4><p>Now we move on to the "C" (Create) of CRUD. Typically, in web applications,
creating a new resource is a multi-step process. First, the user requests a form
to fill out. Then, the user submits the form. If there are no errors, then the
resource is created and some kind of confirmation is displayed. Else, the form
is redisplayed with error messages, and the process is repeated.</p><p>In a Rails application, these steps are conventionally handled by a controller's
<code>new</code> and <code>create</code> actions. Let's add a typical implementation of these actions
to <code>app/controllers/articles_controller.rb</code>, below the <code>show</code> action:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">title: </span><span class="s2">"..."</span><span class="p">,</span> <span class="ss">body: </span><span class="s2">"..."</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:new</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2fea8cd6a3b6af1a62634626eb67e15e">class ArticlesController &lt; ApplicationController
  def index
    @articles = Article.all
  end

  def show
    @article = Article.find(params[:id])
  end

  def new
    @article = Article.new
  end

  def create
    @article = Article.new(title: "...", body: "...")

    if @article.save
      redirect_to @article
    else
      render :new
    end
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2fea8cd6a3b6af1a62634626eb67e15e">Copiar</button>
</div>
<p>The <code>new</code> action instantiates a new article, but does not save it. This article
will be used in the view when building the form. By default, the <code>new</code> action
will render <code>app/views/articles/new.html.erb</code>, which we will create next.</p><p>The <code>create</code> action instantiates a new article with values for the title and
body, and attempts to save it. If the article is saved successfully, the action
redirects the browser to the article's page at <code>"http://localhost:3000/articles/#{@article.id}"</code>.
Else, the action redisplays the form by rendering <code>app/views/articles/new.html.erb</code>.
The title and body here are dummy values. After we create the form, we will come
back and change these.</p><div class="note"><p><a href="https://api.rubyonrails.org/v6.1.0/classes/ActionController/Redirecting.html#method-i-redirect_to"><code>redirect_to</code></a>
will cause the browser to make a new request,
whereas <a href="https://api.rubyonrails.org/v6.1.0/classes/AbstractController/Rendering.html#method-i-render"><code>render</code></a>
renders the specified view for the current request.
It is important to use <code>redirect_to</code> after mutating the database or application state.
Otherwise, if the user refreshes the page, the browser will make the same request, and the mutation will be repeated.</p></div><h5 id="using-a-form-builder"><a class="anchorlink" href="#using-a-form-builder">6.3.1 Using a Form Builder</a></h5><p>We will use a feature of Rails called a <em>form builder</em> to create our form. Using
a form builder, we can write a minimal amount of code to output a form that is
fully configured and follows Rails conventions.</p><p>Let's create <code>app/views/articles/new.html.erb</code> with the following contents:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>New Article<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@article</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-dc4bbbcb410ecea15be8067e1bea5a28">&lt;h1&gt;New Article&lt;/h1&gt;

&lt;%= form_with model: @article do |form| %&gt;
  &lt;div&gt;
    &lt;%= form.label :title %&gt;&lt;br&gt;
    &lt;%= form.text_field :title %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.submit %&gt;
  &lt;/div&gt;
&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-dc4bbbcb410ecea15be8067e1bea5a28">Copiar</button>
</div>
<p>The <a href="https://api.rubyonrails.org/v6.1.0/classes/ActionView/Helpers/FormHelper.html#method-i-form_with"><code>form_with</code></a>
helper method instantiates a form builder. In the <code>form_with</code> block we call
methods like <a href="https://api.rubyonrails.org/v6.1.0/classes/ActionView/Helpers/FormBuilder.html#method-i-label"><code>label</code></a>
and <a href="https://api.rubyonrails.org/v6.1.0/classes/ActionView/Helpers/FormBuilder.html#method-i-text_field"><code>text_field</code></a>
on the form builder to output the appropriate form elements.</p><p>The resulting output from our <code>form_with</code> call will look like:</p><div class="code_container">
<pre><code class="highlight html"><span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"/articles"</span> <span class="na">accept-charset=</span><span class="s">"UTF-8"</span> <span class="na">method=</span><span class="s">"post"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"hidden"</span> <span class="na">name=</span><span class="s">"authenticity_token"</span> <span class="na">value=</span><span class="s">"..."</span><span class="nt">&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"article_title"</span><span class="nt">&gt;</span>Title<span class="nt">&lt;/label&gt;&lt;br&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"article[title]"</span> <span class="na">id=</span><span class="s">"article_title"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"article_body"</span><span class="nt">&gt;</span>Body<span class="nt">&lt;/label&gt;&lt;br&gt;</span>
    <span class="nt">&lt;textarea</span> <span class="na">name=</span><span class="s">"article[body]"</span> <span class="na">id=</span><span class="s">"article_body"</span><span class="nt">&gt;&lt;/textarea&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">name=</span><span class="s">"commit"</span> <span class="na">value=</span><span class="s">"Create Article"</span> <span class="na">data-disable-with=</span><span class="s">"Create Article"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-80eee224e02d33b8f2fa02e8942a8fc2">&lt;form action="/articles" accept-charset="UTF-8" method="post"&gt;
  &lt;input type="hidden" name="authenticity_token" value="..."&gt;

  &lt;div&gt;
    &lt;label for="article_title"&gt;Title&lt;/label&gt;&lt;br&gt;
    &lt;input type="text" name="article[title]" id="article_title"&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;label for="article_body"&gt;Body&lt;/label&gt;&lt;br&gt;
    &lt;textarea name="article[body]" id="article_body"&gt;&lt;/textarea&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;input type="submit" name="commit" value="Create Article" data-disable-with="Create Article"&gt;
  &lt;/div&gt;
&lt;/form&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-80eee224e02d33b8f2fa02e8942a8fc2">Copiar</button>
</div>
<div class="info"><p>To learn more about form builders, see <a href="form_helpers.html">Action View Form Helpers</a>.</p></div><h5 id="using-strong-parameters"><a class="anchorlink" href="#using-strong-parameters">6.3.2 Using Strong Parameters</a></h5><p>Submitted form data is put into the <code>params</code> Hash, alongside captured route
parameters. Thus, the <code>create</code> action can access the submitted title via
<code>params[:article][:title]</code> and the submitted body via <code>params[:article][:body]</code>.
We could pass these values individually to <code>Article.new</code>, but that would be
verbose and possibly error-prone. And it would become worse as we add more
fields.</p><p>Instead, we will pass a single Hash that contains the values. However, we must
still specify what values are allowed in that Hash. Otherwise, a malicious user
could potentially submit extra form fields and overwrite private data. In fact,
if we pass the unfiltered <code>params[:article]</code> Hash directly to <code>Article.new</code>,
Rails will raise a <code>ForbiddenAttributesError</code> to alert us about the problem.
So we will use a feature of Rails called <em>Strong Parameters</em> to filter <code>params</code>.
Think of it as <a href="https://en.wikipedia.org/wiki/Strong_and_weak_typing">strong typing</a>
for <code>params</code>.</p><p>Let's add a private method to the bottom of <code>app/controllers/articles_controller.rb</code>
named <code>article_params</code> that filters <code>params</code>. And let's change <code>create</code> to use
it:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:new</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">article_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:article</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:body</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2e40b0c95102ee93f4025bb09f8ba974">class ArticlesController &lt; ApplicationController
  def index
    @articles = Article.all
  end

  def show
    @article = Article.find(params[:id])
  end

  def new
    @article = Article.new
  end

  def create
    @article = Article.new(article_params)

    if @article.save
      redirect_to @article
    else
      render :new
    end
  end

  private
    def article_params
      params.require(:article).permit(:title, :body)
    end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2e40b0c95102ee93f4025bb09f8ba974">Copiar</button>
</div>
<div class="info"><p>To learn more about Strong Parameters, see <a href="action_controller_overview.html#strong-parameters">Action Controller Overview §
Strong Parameters</a>.</p></div><h5 id="validations-and-displaying-error-messages"><a class="anchorlink" href="#validations-and-displaying-error-messages">6.3.3 Validations and Displaying Error Messages</a></h5><p>As we have seen, creating a resource is a multi-step process. Handling invalid
user input is another step of that process. Rails provides a feature called
<em>validations</em> to help us deal with invalid user input. Validations are rules
that are checked before a model object is saved. If any of the checks fail, the
save will be aborted, and appropriate error messages will be added to the
<code>errors</code> attribute of the model object.</p><p>Let's add some validations to our model in <code>app/models/article.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">10</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-614b52dee7ad021cc82fea943d96ee43">class Article &lt; ApplicationRecord
  validates :title, presence: true
  validates :body, presence: true, length: { minimum: 10 }
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-614b52dee7ad021cc82fea943d96ee43">Copiar</button>
</div>
<p>The first validation declares that a <code>title</code> value must be present. Because
<code>title</code> is a string, this means that the <code>title</code> value must contain at least one
non-whitespace character.</p><p>The second validation declares that a <code>body</code> value must also be present.
Additionally, it declares that the <code>body</code> value must be at least 10 characters
long.</p><div class="note"><p>You may be wondering where the <code>title</code> and <code>body</code> attributes are defined.
Active Record automatically defines model attributes for every table column, so
you don't have to declare those attributes in your model file.</p></div><p>With our validations in place, let's modify <code>app/views/articles/new.html.erb</code> to
display any error messages for <code>title</code> and <code>body</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>New Article<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="vi">@article</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages_for</span><span class="p">(</span><span class="ss">:title</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">message</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;div&gt;</span><span class="cp">&lt;%=</span> <span class="n">message</span> <span class="cp">%&gt;</span><span class="nt">&lt;/div&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages_for</span><span class="p">(</span><span class="ss">:body</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">message</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;div&gt;</span><span class="cp">&lt;%=</span> <span class="n">message</span> <span class="cp">%&gt;</span><span class="nt">&lt;/div&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-d431cd61a82ba82ec27c648ce4428ac6">&lt;h1&gt;New Article&lt;/h1&gt;

&lt;%= form_with model: @article do |form| %&gt;
  &lt;div&gt;
    &lt;%= form.label :title %&gt;&lt;br&gt;
    &lt;%= form.text_field :title %&gt;
    &lt;%= @article.errors.full_messages_for(:title).each do |message| %&gt;
      &lt;div&gt;&lt;%= message %&gt;&lt;/div&gt;
    &lt;% end %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;&lt;br&gt;
    &lt;%= @article.errors.full_messages_for(:body).each do |message| %&gt;
      &lt;div&gt;&lt;%= message %&gt;&lt;/div&gt;
    &lt;% end %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.submit %&gt;
  &lt;/div&gt;
&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-d431cd61a82ba82ec27c648ce4428ac6">Copiar</button>
</div>
<p>The <a href="https://api.rubyonrails.org/v6.1.0/classes/ActiveModel/Errors.html#method-i-full_messages_for"><code>full_messages_for</code></a>
method returns an array of user-friendly error messages for a specified
attribute. If there are no errors for that attribute, the array will be empty.</p><p>To understand how all of this works together, let's take another look at the
<code>new</code> and <code>create</code> controller actions:</p><div class="code_container">
<pre><code class="highlight ruby">  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:new</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-8d27c521997837e35ac3b6349dde5f09">  def new
    @article = Article.new
  end

  def create
    @article = Article.new(article_params)

    if @article.save
      redirect_to @article
    else
      render :new
    end
  end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-8d27c521997837e35ac3b6349dde5f09">Copiar</button>
</div>
<p>When we visit <a href="http://localhost:3000/articles/new">http://localhost:3000/articles/new</a>, the <code>GET /articles/new</code>
request is mapped to the <code>new</code> action. The <code>new</code> action does not attempt to save
<code>@article</code>. Therefore, validations are not checked, and there will be no error
messages.</p><p>When we submit the form, the <code>POST /articles</code> request is mapped to the <code>create</code>
action. The <code>create</code> action <em>does</em> attempt to save <code>@article</code>. Therefore,
validations <em>are</em> checked. If any validation fails, <code>@article</code> will not be
saved, and <code>app/views/articles/new.html.erb</code> will be rendered with error
messages.</p><div class="info"><p>To learn more about validations, see <a href="active_record_validations.html">Active Record Validations</a>. To learn more about validation error messages,
see <a href="active_record_validations.html#working-with-validation-errors">Active Record Validations § Working with Validation Errors</a>.</p></div><h5 id="creating-a-new-article-finishing-up"><a class="anchorlink" href="#creating-a-new-article-finishing-up">6.3.4 Finishing Up</a></h5><p>We can now create an article by visiting <a href="http://localhost:3000/articles/new">http://localhost:3000/articles/new</a>.
To finish up, let's link to that page from the bottom of
<code>app/views/articles/index.html.erb</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span><span class="p">,</span> <span class="n">article</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"New Article"</span><span class="p">,</span> <span class="n">new_article_path</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-019dc1158d09eaa7b1ef417f7f412691">&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;li&gt;
      &lt;%= link_to article.title, article %&gt;
    &lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;

&lt;%= link_to "New Article", new_article_path %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-019dc1158d09eaa7b1ef417f7f412691">Copiar</button>
</div>
<h4 id="updating-an-article"><a class="anchorlink" href="#updating-an-article">6.4 Updating an Article</a></h4><p>We've covered the "CR" of CRUD. Now let's move on to the "U" (Update). Updating
a resource is very similar to creating a resource. They are both multi-step
processes. First, the user requests a form to edit the data. Then, the user
submits the form. If there are no errors, then the resource is updated. Else,
the form is redisplayed with error messages, and the process is repeated.</p><p>These steps are conventionally handled by a controller's <code>edit</code> and <code>update</code>
actions. Let's add a typical implementation of these actions to
<code>app/controllers/articles_controller.rb</code>, below the <code>create</code> action:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:new</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:edit</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">article_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:article</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:body</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-25a6f1772f6fbc4d23cfa4b96243b241">class ArticlesController &lt; ApplicationController
  def index
    @articles = Article.all
  end

  def show
    @article = Article.find(params[:id])
  end

  def new
    @article = Article.new
  end

  def create
    @article = Article.new(article_params)

    if @article.save
      redirect_to @article
    else
      render :new
    end
  end

  def edit
    @article = Article.find(params[:id])
  end

  def update
    @article = Article.find(params[:id])

    if @article.update(article_params)
      redirect_to @article
    else
      render :edit
    end
  end

  private
    def article_params
      params.require(:article).permit(:title, :body)
    end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-25a6f1772f6fbc4d23cfa4b96243b241">Copiar</button>
</div>
<p>Notice how the <code>edit</code> and <code>update</code> actions resemble the <code>new</code> and <code>create</code>
actions.</p><p>The <code>edit</code> action fetches the article from the database, and stores it in
<code>@article</code> so that it can be used when building the form. By default, the <code>edit</code>
action will render <code>app/views/articles/edit.html.erb</code>.</p><p>The <code>update</code> action (re-)fetches the article from the database, and attempts
to update it with the submitted form data filtered by <code>article_params</code>. If no
validations fail and the update is successful, the action redirects the browser
to the article's page. Else, the action redisplays the form, with error
messages, by rendering <code>app/views/articles/edit.html.erb</code>.</p><h5 id="using-partials-to-share-view-code"><a class="anchorlink" href="#using-partials-to-share-view-code">6.4.1 Using Partials to Share View Code</a></h5><p>Our <code>edit</code> form will look the same as our <code>new</code> form. Even the code will be the
same, thanks to the Rails form builder and resourceful routing. The form builder
automatically configures the form to make the appropriate kind of request, based
on whether the model object has been previously saved.</p><p>Because the code will be the same, we're going to factor it out into a shared
view called a <em>partial</em>. Let's create <code>app/views/articles/_form.html.erb</code> with
the following contents:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="n">article</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:title</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:title</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages_for</span><span class="p">(</span><span class="ss">:title</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">message</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;div&gt;</span><span class="cp">&lt;%=</span> <span class="n">message</span> <span class="cp">%&gt;</span><span class="nt">&lt;/div&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">article</span><span class="p">.</span><span class="nf">errors</span><span class="p">.</span><span class="nf">full_messages_for</span><span class="p">(</span><span class="ss">:body</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">message</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;div&gt;</span><span class="cp">&lt;%=</span> <span class="n">message</span> <span class="cp">%&gt;</span><span class="nt">&lt;/div&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-1a09d35be630c243a2465c845edac13d">&lt;%= form_with model: article do |form| %&gt;
  &lt;div&gt;
    &lt;%= form.label :title %&gt;&lt;br&gt;
    &lt;%= form.text_field :title %&gt;
    &lt;%= article.errors.full_messages_for(:title).each do |message| %&gt;
      &lt;div&gt;&lt;%= message %&gt;&lt;/div&gt;
    &lt;% end %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;&lt;br&gt;
    &lt;%= article.errors.full_messages_for(:body).each do |message| %&gt;
      &lt;div&gt;&lt;%= message %&gt;&lt;/div&gt;
    &lt;% end %&gt;
  &lt;/div&gt;

  &lt;div&gt;
    &lt;%= form.submit %&gt;
  &lt;/div&gt;
&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-1a09d35be630c243a2465c845edac13d">Copiar</button>
</div>
<p>The above code is the same as our form in <code>app/views/articles/new.html.erb</code>,
except that all occurrences of <code>@article</code> have been replaced with <code>article</code>.
Because partials are shared code, it is best practice that they do not depend on
specific instance variables set by a controller action. Instead, we will pass
the article to the partial as a local variable.</p><p>Let's update <code>app/views/articles/new.html.erb</code> to use the partial via <a href="https://api.rubyonrails.org/v6.1.0/classes/ActionView/Helpers/RenderingHelper.html#method-i-render"><code>render</code></a>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>New Article<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s2">"form"</span><span class="p">,</span> <span class="ss">article: </span><span class="vi">@article</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-3078fe270d91efd656a83014af779174">&lt;h1&gt;New Article&lt;/h1&gt;

&lt;%= render "form", article: @article %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-3078fe270d91efd656a83014af779174">Copiar</button>
</div>
<div class="note"><p>A partial's filename must be prefixed <strong>with</strong> an underscore, e.g.
<code>_form.html.erb</code>. But when rendering, it is referenced <strong>without</strong> the
underscore, e.g. <code>render "form"</code>.</p></div><p>And now, let's create a very similar <code>app/views/articles/edit.html.erb</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Edit Article<span class="nt">&lt;/h1&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s2">"form"</span><span class="p">,</span> <span class="ss">article: </span><span class="vi">@article</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-bf9462c8c418248424851d88ce863428">&lt;h1&gt;Edit Article&lt;/h1&gt;

&lt;%= render "form", article: @article %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-bf9462c8c418248424851d88ce863428">Copiar</button>
</div>
<div class="info"><p>To learn more about partials, see <a href="layouts_and_rendering.html#using-partials">Layouts and Rendering in Rails § Using
Partials</a>.</p></div><h5 id="updating-an-article-finishing-up"><a class="anchorlink" href="#updating-an-article-finishing-up">6.4.2 Finishing Up</a></h5><p>We can now update an article by visiting its edit page, e.g.
<a href="http://localhost:3000/articles/1/edit">http://localhost:3000/articles/1/edit</a>. To finish up, let's link to the edit
page from the bottom of <code>app/views/articles/show.html.erb</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Edit"</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-0a1ae11ce16be3d740b9a427fd060e7a">&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to "Edit", edit_article_path(@article) %&gt;&lt;/li&gt;
&lt;/ul&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-0a1ae11ce16be3d740b9a427fd060e7a">Copiar</button>
</div>
<h4 id="deleting-an-article"><a class="anchorlink" href="#deleting-an-article">6.5 Deleting an Article</a></h4><p>Finally, we arrive at the "D" (Delete) of CRUD. Deleting a resource is a simpler
process than creating or updating. It only requires a route and a controller
action. And our resourceful routing (<code>resources :articles</code>) already provides the
route, which maps <code>DELETE /articles/:id</code> requests to the <code>destroy</code> action of
<code>ArticlesController</code>.</p><p>So, let's add a typical <code>destroy</code> action to <code>app/controllers/articles_controller.rb</code>,
below the <code>update</code> action:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">save</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:new</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>

    <span class="k">if</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">article_params</span><span class="p">)</span>
      <span class="n">redirect_to</span> <span class="vi">@article</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:edit</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
    <span class="vi">@article</span><span class="p">.</span><span class="nf">destroy</span>

    <span class="n">redirect_to</span> <span class="n">root_path</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">article_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:article</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:title</span><span class="p">,</span> <span class="ss">:body</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2a2c72770cf1832fd9cc181a9ef66043">class ArticlesController &lt; ApplicationController
  def index
    @articles = Article.all
  end

  def show
    @article = Article.find(params[:id])
  end

  def new
    @article = Article.new
  end

  def create
    @article = Article.new(article_params)

    if @article.save
      redirect_to @article
    else
      render :new
    end
  end

  def edit
    @article = Article.find(params[:id])
  end

  def update
    @article = Article.find(params[:id])

    if @article.update(article_params)
      redirect_to @article
    else
      render :edit
    end
  end

  def destroy
    @article = Article.find(params[:id])
    @article.destroy

    redirect_to root_path
  end

  private
    def article_params
      params.require(:article).permit(:title, :body)
    end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2a2c72770cf1832fd9cc181a9ef66043">Copiar</button>
</div>
<p>The <code>destroy</code> action fetches the article from the database, and calls <a href="https://api.rubyonrails.org/v6.1.0/classes/ActiveRecord/Persistence.html#method-i-destroy"><code>destroy</code></a>
on it. Then, it redirects the browser to the root path.</p><p>We have chosen to redirect to the root path because that is our main access
point for articles. But, in other circumstances, you might choose to redirect to
e.g. <code>articles_path</code>.</p><p>Now let's add a link at the bottom of <code>app/views/articles/show.html.erb</code> so that
we can delete an article from its own page:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Edit"</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Destroy"</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">),</span>
                  <span class="ss">method: :delete</span><span class="p">,</span>
                  <span class="ss">data: </span><span class="p">{</span> <span class="ss">confirm: </span><span class="s2">"Are you sure?"</span> <span class="p">}</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-750067fec0f9c3f478016b4154460f9e">&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to "Edit", edit_article_path(@article) %&gt;&lt;/li&gt;
  &lt;li&gt;&lt;%= link_to "Destroy", article_path(@article),
                  method: :delete,
                  data: { confirm: "Are you sure?" } %&gt;&lt;/li&gt;
&lt;/ul&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-750067fec0f9c3f478016b4154460f9e">Copiar</button>
</div>
<p>In the above code, we're passing a few additional options to <code>link_to</code>. The
<code>method: :delete</code> option causes the link to make a <code>DELETE</code> request instead of a
<code>GET</code> request. The <code>data: { confirm: "Are you sure?" }</code> option causes a
confirmation dialog to appear when the link is clicked. If the user cancels the
dialog, the request is aborted. Both of these options are powered by a feature
of Rails called <em>Unobtrusive JavaScript</em> (UJS). The JavaScript file that
implements these behaviors is included by default in fresh Rails applications.</p><div class="info"><p>To learn more about Unobtrusive JavaScript, see <a href="working_with_javascript_in_rails.html">Working With JavaScript in
Rails</a>.</p></div><p>And that's it! We can now list, show, create, update, and delete articles!
InCRUDable!</p><h3 id="adicionando-um-segundo-model"><a class="anchorlink" href="#adicionando-um-segundo-model">7 Adicionando um Segundo Model</a></h3><p>É hora de adicionar um segundo <em>model</em> à aplicação. O segundo <em>model</em> vai lidar com
comentários em artigos.</p><h4 id="gerando-um-model"><a class="anchorlink" href="#gerando-um-model">7.1 Gerando um Model</a></h4><p>Nós veremos o mesmo <em>generator</em> que usamos antes quando criamos o <em>model</em>
<code>Article</code> (artigo, inglês). Desta vez vamos criar um <em>model</em> <code>Comment</code> (comentário)
que contém a referência para um artigo. Rode esse comando no seu terminal:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate model Comment commenter:string body:text article:references
</code></pre>
<textarea class="clipboard-content" id="clipboard-7528dc48aca0487e50f39063e8093ab3">bin/rails generate model Comment commenter:string body:text article:references
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-7528dc48aca0487e50f39063e8093ab3">Copiar</button>
</div>
<p>Este comando vai gerar quatro arquivos:</p>
<table>
<thead>
<tr>
<th>Arquivo</th>
<th>Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<td>db/migrate/20140120201010_create_comments.rb</td>
<td>
<em>Migration</em> para criar a tabela de comentários no seu banco de dados (o nome incluirá um <em>timestamp</em> diferente)</td>
</tr>
<tr>
<td>app/models/comment.rb</td>
<td>O <em>model</em> Comment</td>
</tr>
<tr>
<td>test/models/comment_test.rb</td>
<td>Aparelhagem de testes para o <em>model</em> de comentário</td>
</tr>
<tr>
<td>test/fixtures/comments.yml</td>
<td>Exemplo de comentários para uso em testes</td>
</tr>
</tbody>
</table>
<p>Primeiro, veja o arquivo <code>app/models/comment.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:article</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-150c61c85311564e9bcb901a107ccd8a">class Comment &lt; ApplicationRecord
  belongs_to :article
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-150c61c85311564e9bcb901a107ccd8a">Copiar</button>
</div>
<p>Isso é muito semelhante ao <em>model</em> <code>Article</code> que vimos antes. A diferença está na
linha <code>belongs_to : article</code>, o que configura uma associação no <em>Active Record</em>.
Você vai aprender um pouco sobre associações na próxima seção deste guia.</p><p>A palavra-chave (<code>:references</code>) usada no comando <code>bash</code> é um tipo especial de
dado para <em>models</em>. Ela cria uma nova coluna na tabela do banco de dados com o
nome fornecido ao <em>model</em> anexada a um <code>_id</code> que contém um valor do tipo
<em>integer</em>. Para compreender melhor, analise o arquivo <code>db/schema.rb</code> depois de
rodar a <em>migration</em>.</p><p>Além do <em>model</em>, o Rails também gerou a <em>migration</em> para criar a tabela
correspondente no banco de dados:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">CreateComments</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span><span class="p">[</span><span class="mf">6.0</span><span class="p">]</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:comments</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">string</span> <span class="ss">:commenter</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">text</span> <span class="ss">:body</span>
      <span class="n">t</span><span class="p">.</span><span class="nf">references</span> <span class="ss">:article</span><span class="p">,</span> <span class="ss">null: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">foreign_key: </span><span class="kp">true</span>

      <span class="n">t</span><span class="p">.</span><span class="nf">timestamps</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-698dea9cc93d91d3c8162b5b28c7950b">class CreateComments &lt; ActiveRecord::Migration[6.0]
  def change
    create_table :comments do |t|
      t.string :commenter
      t.text :body
      t.references :article, null: false, foreign_key: true

      t.timestamps
    end
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-698dea9cc93d91d3c8162b5b28c7950b">Copiar</button>
</div>
<p>A linha <code>t.references</code> cria uma coluna com valores do tipo <em>integer</em> chamada
<code>article_id</code>, um índice para ela e uma restrição de chave estrangeira (<em>foreign key</em>)
que aponta para a coluna <code>id</code> da tabela <code>articles</code>. Vá em frente e rode a
<em>migration</em>:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>db:migrate
</code></pre>
<textarea class="clipboard-content" id="clipboard-a406903be78e25c6163b5c979b3a10be">bin/rails db:migrate
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-a406903be78e25c6163b5c979b3a10be">Copiar</button>
</div>
<p>O Rails é inteligente o suficiente para executar somente as migrações que ainda
não foram rodadas no banco de dados atual, assim neste caso você verá:</p><div class="code_container">
<pre><code class="highlight plaintext">==  CreateComments: migrating =================================================
-- create_table(:comments)
   -&gt; 0.0115s
==  CreateComments: migrated (0.0119s) ========================================
</code></pre>
<textarea class="clipboard-content" id="clipboard-ac1f3f8384224f0b9ef174636b2cf984">==  CreateComments: migrating =================================================
-- create_table(:comments)
   -&gt; 0.0115s
==  CreateComments: migrated (0.0119s) ========================================
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-ac1f3f8384224f0b9ef174636b2cf984">Copiar</button>
</div>
<h4 id="associando-models"><a class="anchorlink" href="#associando-models">7.2 Associando Models</a></h4><p>Associações do <em>Active Record</em> permitem declarar facilmente a relação entre dois
<em>models</em>. No caso de comentários e artigos, você poderia descrever a relação
da seguinte maneira:</p>
<ul>
<li>Cada comentário pertece a um artigo.</li>
<li>Um artigo pode possuir muitos comentários.</li>
</ul>
<p>De fato, essa sintaxe é muito similar à utilizada pelo Rails para declarar essa
associação. Você já viu a linha de código dentro do <em>model</em> <code>Comment</code>
(<code>app/models/comment.rb</code>) que faz com que cada comentário pertença a um Artigo:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:article</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-687db60ebba304b564beda67bf902fb3">class Comment &lt; ApplicationRecord
  belongs_to :article
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-687db60ebba304b564beda67bf902fb3">Copiar</button>
</div>
<p>Você vai precisar editar o arquivo <code>app/models/article.rb</code> para adicionar o outro lado da
associação:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:comments</span>

  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">10</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-72e208bf672235c04d70872905bf8274">class Article &lt; ApplicationRecord
  has_many :comments

  validates :title, presence: true
  validates :body, presence: true, length: { minimum: 10 }
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-72e208bf672235c04d70872905bf8274">Copiar</button>
</div>
<p>Estas duas declarações habilitam uma boa parte de comportamento automático. Por
exemplo, se você possui uma instância da variável <code>@article</code> que contém um
artigo, você pode recuperar todos os comentários pertencentes àquele artigo na
forma de um <em>array</em> usando <code>@article.comments</code>.</p><div class="info"><p>Para mais informações sobre associações do <em>Active Record</em>, veja o guia
<a href="association_basics.html">Associações no Active Record</a>.</p></div><h4 id="adicionando-a-rota-para-comentarios"><a class="anchorlink" href="#adicionando-a-rota-para-comentarios">7.3 Adicionando a Rota para Comentários</a></h4><p>Da mesma forma que o <em>controller</em> <code>welcome</code>, nós vamos precisar adicionar a
rota para que o Rails saiba para onde queremos navegar para encontrar
<code>comments</code>. Abra o arquivo <code>config/routes.rb</code> novamente e o edite da seguinte
maneira:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="no">Rails</span><span class="p">.</span><span class="nf">application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">root</span> <span class="s2">"articles#index"</span>

  <span class="n">resources</span> <span class="ss">:articles</span> <span class="k">do</span>
    <span class="n">resources</span> <span class="ss">:comments</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-c7dc28413930598373ff550a0485e831">Rails.application.routes.draw do
  root "articles#index"

  resources :articles do
    resources :comments
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-c7dc28413930598373ff550a0485e831">Copiar</button>
</div>
<p>Isso cria <code>comments</code> como um recurso aninhado (<em>nested resource</em>) dentro de <code>article</code>. Essa é
outra parte do processo para recuperar as relações hierárquicas que existem  entre
artigos e comentários.</p><div class="info"><p>Para mais informações sobre rotas, veja o guia <a href="routing.html">Roteamento no Rails</a></p></div><h4 id="gerando-um-controller"><a class="anchorlink" href="#gerando-um-controller">7.4 Gerando um Controller</a></h4><p>Com o <em>model</em> em mãos, você pode voltar sua atenção para a criação do
<em>controller</em> correspondente. Mais uma vez, você vai usar o <em>generator</em> usado
anteriormente:</p><div class="code_container">
<pre><code class="highlight console"><span class="gp">$</span><span class="w"> </span><span class="nb">bin/rails </span>generate controller Comments
</code></pre>
<textarea class="clipboard-content" id="clipboard-2a88b05fb94de2f4c96d03cf2fbc56fa">bin/rails generate controller Comments
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2a88b05fb94de2f4c96d03cf2fbc56fa">Copiar</button>
</div>
<p>Isso cria quatro arquivos e um diretório vazio:</p>
<table>
<thead>
<tr>
<th>Arquivo/Diretório</th>
<th>Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<td>app/controllers/comments_controller.rb</td>
<td>O <em>controller</em> de comentários</td>
</tr>
<tr>
<td>app/views/comments/</td>
<td>
<em>Views</em> do <em>controller</em> são armazenadas aqui</td>
</tr>
<tr>
<td>test/controllers/comments_controller_test.rb</td>
<td>O teste para o <em>controller</em>
</td>
</tr>
<tr>
<td>app/helpers/comments_helper.rb</td>
<td>Arquivo de <em>helpers</em> da <em>view</em>
</td>
</tr>
<tr>
<td>app/assets/stylesheets/comments.scss</td>
<td>
<em>Cascading style sheet</em> (CSS) para o <em>controller</em>
</td>
</tr>
</tbody>
</table>
<p>Como em qualquer blog, nossos leitores vão criar seus comentários diretamente
depois de lerem o artigo e, uma vez que adicionarem o comentário, serão enviados
de volta para a página <em>show</em> do artigo para verem o comentário agora listado.
Por essa razão, nosso <code>CommentsController</code> está aqui para fornecer um método que
cria comentários e deleta comentários <em>spam</em> quando chegarem.</p><p>Então, primeiro nós vamos ligar o <em>show template</em> para Artigos (<code>app/views/articles/show.html.erb</code>)
para que possamos criar um novo comentários:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Edit"</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Destroy"</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">),</span>
                  <span class="ss">method: :delete</span><span class="p">,</span>
                  <span class="ss">data: </span><span class="p">{</span> <span class="ss">confirm: </span><span class="s2">"Are you sure?"</span> <span class="p">}</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="nt">&lt;h2&gt;</span>Add a comment:<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="p">[</span> <span class="vi">@article</span><span class="p">,</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">build</span> <span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-895f701f9a95d3c49171911932312597">&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to "Edit", edit_article_path(@article) %&gt;&lt;/li&gt;
  &lt;li&gt;&lt;%= link_to "Destroy", article_path(@article),
                  method: :delete,
                  data: { confirm: "Are you sure?" } %&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Add a comment:&lt;/h2&gt;
&lt;%= form_with model: [ @article, @article.comments.build ] do |form| %&gt;
  &lt;p&gt;
    &lt;%= form.label :commenter %&gt;&lt;br&gt;
    &lt;%= form.text_field :commenter %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.submit %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-895f701f9a95d3c49171911932312597">Copiar</button>
</div>
<p>Isso adiciona na página <em>show</em> do <code>Article</code> um formulário que cria um novo
comentário chamando a <em>action</em> <code>create</code> no <code>CommentsController</code>. O <code>form_with</code>
aqui usa um <em>array</em> que vai construir uma rota aninhada, como <code>/articles/1/comments</code>.</p><p>Vamos ligar a <em>action</em> <code>create</code> em <code>app/controllers/comments_controller.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:article_id</span><span class="p">])</span>
    <span class="vi">@comment</span> <span class="o">=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">comment_params</span><span class="p">)</span>
    <span class="n">redirect_to</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">comment_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:comment</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:commenter</span><span class="p">,</span> <span class="ss">:body</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-137563304e78d1ce46a54052615be5c6">class CommentsController &lt; ApplicationController
  def create
    @article = Article.find(params[:article_id])
    @comment = @article.comments.create(comment_params)
    redirect_to article_path(@article)
  end

  private
    def comment_params
      params.require(:comment).permit(:commenter, :body)
    end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-137563304e78d1ce46a54052615be5c6">Copiar</button>
</div>
<p>Você verá um pouco mais de complexidade aqui do que no <em>controller</em> para
artigos. Esse é o efeito colateral do aninhamento que você configurou. Cada
requisição para um comentário deve lembrar o artigo ao qual o comentário está
anexado, para que a chamada inicial do método <code>find</code> do <em>model</em> <code>Article</code>
encontre o artigo em questão.</p><p>Além disso, o código aproveita-se de alguns métodos disponíveis para uma
associação. Nós usamos o método <code>create</code> em <code>@article.comments</code> para criar e
salvar um comentário. Isso vai automaticamente conectar o comentário para que
ele pertença àquele artigo em particular.</p><p>Uma vez que temos um novo comentário, nós enviamos o usuário de volta ao artigo
original usando o helper <code>article_path(@article)</code>. Como já vimos
anteriormente, isso chama a <em>action</em> <code>show</code> do <code>ArticlesController</code> que por sua
vez renderiza o <em>template</em> <code>show.html.erb</code>. É aqui que queremos que o comentário
apareça, então vamos adicionar isso ao arquivo <code>app/views/articles/show.html.erb</code>.</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Edit"</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Destroy"</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">),</span>
                  <span class="ss">method: :delete</span><span class="p">,</span>
                  <span class="ss">data: </span><span class="p">{</span> <span class="ss">confirm: </span><span class="s2">"Are you sure?"</span> <span class="p">}</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="nt">&lt;h2&gt;</span>Comments<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">comment</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;strong&gt;</span>Commenter:<span class="nt">&lt;/strong&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>

  <span class="nt">&lt;p&gt;</span>
    <span class="nt">&lt;strong&gt;</span>Comment:<span class="nt">&lt;/strong&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;h2&gt;</span>Add a comment:<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="p">[</span> <span class="vi">@article</span><span class="p">,</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">build</span> <span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-c26d214c31b8cf328962e3087a6293a8">&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to "Edit", edit_article_path(@article) %&gt;&lt;/li&gt;
  &lt;li&gt;&lt;%= link_to "Destroy", article_path(@article),
                  method: :delete,
                  data: { confirm: "Are you sure?" } %&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Comments&lt;/h2&gt;
&lt;% @article.comments.each do |comment| %&gt;
  &lt;p&gt;
    &lt;strong&gt;Commenter:&lt;/strong&gt;
    &lt;%= comment.commenter %&gt;
  &lt;/p&gt;

  &lt;p&gt;
    &lt;strong&gt;Comment:&lt;/strong&gt;
    &lt;%= comment.body %&gt;
  &lt;/p&gt;
&lt;% end %&gt;

&lt;h2&gt;Add a comment:&lt;/h2&gt;
&lt;%= form_with model: [ @article, @article.comments.build ] do |form| %&gt;
  &lt;p&gt;
    &lt;%= form.label :commenter %&gt;&lt;br&gt;
    &lt;%= form.text_field :commenter %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.submit %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-c26d214c31b8cf328962e3087a6293a8">Copiar</button>
</div>
<p>Agora podemos adicionar artigos e comentários ao seu blog e mostrá-los nos
lugares certos.</p><p><img src="images/getting_started/article_with_comments.png" alt="Article with Comments"></p><h3 id="refatorando"><a class="anchorlink" href="#refatorando">8 Refatorando</a></h3><p>Agora que nossos artigos e comentários funcionam, dê uma olhada no template
<code>app/views/articles/show.html.erb</code>. Ele está ficando longo e esquisito. Nós
podemos usar <em>partials</em> (<em>views</em> parciais) para melhorá-lo.</p><h4 id="renderizando-colecoes-de-partials"><a class="anchorlink" href="#renderizando-colecoes-de-partials">8.1 Renderizando Coleções de <em>Partials</em></a></h4><p>Primeiramente, nós vamos criar uma <em>partial</em> para extrair a exibição de todos os
comentários para o artigo. Crie o arquivo <code>app/views/comments/_comment.html.erb</code>
e insira o código a seguir:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Commenter:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">commenter</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Comment:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-da06be88b37cf616295a178bcb0e57ae">&lt;p&gt;
  &lt;strong&gt;Commenter:&lt;/strong&gt;
  &lt;%= comment.commenter %&gt;
&lt;/p&gt;

&lt;p&gt;
  &lt;strong&gt;Comment:&lt;/strong&gt;
  &lt;%= comment.body %&gt;
&lt;/p&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-da06be88b37cf616295a178bcb0e57ae">Copiar</button>
</div>
<p>Então você pode mudar <code>app/views/articles/show.html.erb</code> para o seguinte código:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Edit"</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Destroy"</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">),</span>
                  <span class="ss">method: :delete</span><span class="p">,</span>
                  <span class="ss">data: </span><span class="p">{</span> <span class="ss">confirm: </span><span class="s2">"Are you sure?"</span> <span class="p">}</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="nt">&lt;h2&gt;</span>Comments<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;h2&gt;</span>Add a comment:<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="p">[</span> <span class="vi">@article</span><span class="p">,</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">build</span> <span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2b68c13ba5da57475317ce364d57e04e">&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to "Edit", edit_article_path(@article) %&gt;&lt;/li&gt;
  &lt;li&gt;&lt;%= link_to "Destroy", article_path(@article),
                  method: :delete,
                  data: { confirm: "Are you sure?" } %&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Comments&lt;/h2&gt;
&lt;%= render @article.comments %&gt;

&lt;h2&gt;Add a comment:&lt;/h2&gt;
&lt;%= form_with model: [ @article, @article.comments.build ] do |form| %&gt;
  &lt;p&gt;
    &lt;%= form.label :commenter %&gt;&lt;br&gt;
    &lt;%= form.text_field :commenter %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.submit %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2b68c13ba5da57475317ce364d57e04e">Copiar</button>
</div>
<p>Isso fará com que a <em>partial</em> seja renderizada em <code>app/views/comments/_comment.html.erb</code>
uma vez para cada comentário na coleção <code>@article.comments</code>. Como o método
<code>render</code> itera sobre a coleção <code>@article.comments</code>, ele designa cada comentário
para uma variável local nomeada como a <em>partial</em>, nesse caso <code>comment</code>, que então
fica disponível para ser exibida na <em>partial</em>.</p><h4 id="renderizando-um-formulario-com-partial"><a class="anchorlink" href="#renderizando-um-formulario-com-partial">8.2 Renderizando um Formulário com <em>Partial</em></a></h4><p>Agora vamos mover aquela nova seção de comentários para sua própria <em>partial</em>.
Novamente, crie o arquivo <code>app/viewscomments/_form.html.erb</code> contendo:</p><div class="code_container">
<pre><code class="highlight erb"><span class="cp">&lt;%=</span> <span class="n">form_with</span> <span class="ss">model: </span><span class="p">[</span> <span class="vi">@article</span><span class="p">,</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">build</span> <span class="p">]</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:commenter</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">label</span> <span class="ss">:body</span> <span class="cp">%&gt;</span><span class="nt">&lt;br&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">text_area</span> <span class="ss">:body</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;p&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">form</span><span class="p">.</span><span class="nf">submit</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/p&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-250697afda6b842c55f0e80bb3db6bd1">&lt;%= form_with model: [ @article, @article.comments.build ] do |form| %&gt;
  &lt;p&gt;
    &lt;%= form.label :commenter %&gt;&lt;br&gt;
    &lt;%= form.text_field :commenter %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.label :body %&gt;&lt;br&gt;
    &lt;%= form.text_area :body %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;%= form.submit %&gt;
  &lt;/p&gt;
&lt;% end %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-250697afda6b842c55f0e80bb3db6bd1">Copiar</button>
</div>
<p>Então deixe o arquivo <code>app/views/articles/show.html.erb</code> assim:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;p&gt;</span><span class="cp">&lt;%=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span><span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Edit"</span><span class="p">,</span> <span class="n">edit_article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
  <span class="nt">&lt;li&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"Destroy"</span><span class="p">,</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">),</span>
                  <span class="ss">method: :delete</span><span class="p">,</span>
                  <span class="ss">data: </span><span class="p">{</span> <span class="ss">confirm: </span><span class="s2">"Are you sure?"</span> <span class="p">}</span> <span class="cp">%&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="nt">&lt;h2&gt;</span>Comments<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span> <span class="cp">%&gt;</span>

<span class="nt">&lt;h2&gt;</span>Add a comment:<span class="nt">&lt;/h2&gt;</span>
<span class="cp">&lt;%=</span> <span class="n">render</span> <span class="s1">'comments/form'</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-cbc45d31d4305f08b9e7d80d25fbaa58">&lt;h1&gt;&lt;%= @article.title %&gt;&lt;/h1&gt;

&lt;p&gt;&lt;%= @article.body %&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;%= link_to "Edit", edit_article_path(@article) %&gt;&lt;/li&gt;
  &lt;li&gt;&lt;%= link_to "Destroy", article_path(@article),
                  method: :delete,
                  data: { confirm: "Are you sure?" } %&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2&gt;Comments&lt;/h2&gt;
&lt;%= render @article.comments %&gt;

&lt;h2&gt;Add a comment:&lt;/h2&gt;
&lt;%= render 'comments/form' %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-cbc45d31d4305f08b9e7d80d25fbaa58">Copiar</button>
</div>
<p>O segundo <em>render</em> apenas define o template de <em>partial</em> que queremos renderizar,
<code>comments/form</code>. O Rails é inteligente o suficiente para entender a barra nessa
string e perceber que você quer renderizar o arquivo <code>_form.html.erb</code> no
diretório <code>app/views/comments</code>.</p><p>O objeto <code>@article</code> está disponível para todas as <em>partials</em> renderizadas na view
porque o definimos como uma variável de instância.</p><h4 id="usando-concerns"><a class="anchorlink" href="#usando-concerns">8.3 Usando <em>Concerns</em></a></h4><p><em>Concerns</em> são uma forma de tornar grandes <em>controllers</em> ou <em>models</em> mais fáceis de entender e gerenciar. Isso também tem a vantagem de ser reutilizável quando vários <em>models</em> (ou <em>controllers</em>) compartilham as mesmas preocupações. As <em>concerns</em> são implementadas usando módulos (<code>module</code>) que contêm métodos que representam uma fatia bem definida da funcionalidade pela qual um <em>model</em> ou <em>controller</em> é responsável. Em outras linguagens, os módulos costumam ser conhecidos como <em>mixins</em>.</p><p>Você pode usar as <em>concerns</em> em seu <em>controller</em> ou <em>model</em> da mesma forma que usaria qualquer módulo. Quando você criou sua aplicação pela primeira vez com <code>rails new blog</code>, duas pastas foram criadas dentro de <code>app/</code> junto com o resto:</p><div class="code_container">
<pre><code class="highlight plaintext"> app/controllers/concerns
 app/models/concerns
</code></pre>
<textarea class="clipboard-content" id="clipboard-18edae0f1e91b5f5c0a2eb95c752c145"> app/controllers/concerns
 app/models/concerns
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-18edae0f1e91b5f5c0a2eb95c752c145">Copiar</button>
</div>
<p> Um determinado artigo do blog pode ter vários status - por exemplo, pode ser visível para todos (ou seja, <code>public</code>), ou visível apenas para o autor (ou seja, <code>private</code>). Também pode estar oculto para todos, mas ainda pode ser recuperado (ou seja, <code>archived</code>). Os comentários também podem estar ocultos ou visíveis. Isso pode ser representado usando uma coluna <code>status</code> em cada um dos <em>models</em>.</p><p>Dentro do <em>model</em> <code>article</code>, após executar uma <em>migration</em> para adicionar uma coluna <code>status</code>, você pode adicionar:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">has_many</span> <span class="ss">:comments</span>

  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">10</span> <span class="p">}</span>

  <span class="no">VALID_STATUSES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'public'</span><span class="p">,</span> <span class="s1">'private'</span><span class="p">,</span> <span class="s1">'archived'</span><span class="p">]</span>

  <span class="n">validates</span> <span class="ss">:status</span><span class="p">,</span> <span class="ss">in: </span><span class="no">VALID_STATUSES</span>

  <span class="k">def</span> <span class="nf">archived?</span>
    <span class="n">status</span> <span class="o">==</span> <span class="s1">'archived'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-03d18c652a9d7bcac58a43954c90d9eb">class Article &lt; ApplicationRecord
  has_many :comments

  validates :title, presence: true
  validates :body, presence: true, length: { minimum: 10 }

  VALID_STATUSES = ['public', 'private', 'archived']

  validates :status, in: VALID_STATUSES

  def archived?
    status == 'archived'
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-03d18c652a9d7bcac58a43954c90d9eb">Copiar</button>
</div>
<p>e no <em>model</em> <code>Comment</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="n">belongs_to</span> <span class="ss">:article</span>

  <span class="no">VALID_STATUSES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'public'</span><span class="p">,</span> <span class="s1">'private'</span><span class="p">,</span> <span class="s1">'archived'</span><span class="p">]</span>

  <span class="n">validates</span> <span class="ss">:status</span><span class="p">,</span> <span class="ss">in: </span><span class="no">VALID_STATUSES</span>

  <span class="k">def</span> <span class="nf">archived?</span>
    <span class="n">status</span> <span class="o">==</span> <span class="s1">'archived'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-cc37109ee60402f846157fa311806cea">class Comment &lt; ApplicationRecord
  belongs_to :article

  VALID_STATUSES = ['public', 'private', 'archived']

  validates :status, in: VALID_STATUSES

  def archived?
    status == 'archived'
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-cc37109ee60402f846157fa311806cea">Copiar</button>
</div>
<p>Então, em nossa <em>action</em> <code>index</code> (<code>app/views/articles/index.html.erb</code>), usaríamos o método <code>archived?</code> Para evitar a exibição de qualquer artigo que está arquivado:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">unless</span> <span class="n">article</span><span class="p">.</span><span class="nf">archived?</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;li&gt;</span>
        <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span><span class="p">,</span> <span class="n">article</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;/li&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"New Article"</span><span class="p">,</span> <span class="n">new_article_path</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-6927d27d28f1e28effb282aa465fda32">&lt;h1&gt;Articles&lt;/h1&gt;

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;% unless article.archived? %&gt;
      &lt;li&gt;
        &lt;%= link_to article.title, article %&gt;
      &lt;/li&gt;
    &lt;% end %&gt;
  &lt;% end %&gt;
&lt;/ul&gt;

&lt;%= link_to "New Article", new_article_path %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-6927d27d28f1e28effb282aa465fda32">Copiar</button>
</div>
<p>No entanto, se você olhar novamente para nossos <em>models</em> agora, pode ver que a lógica está duplicada. Se, no futuro, aumentarmos a funcionalidade do nosso blog - para incluir mensagens privadas, por exemplo - podemos ver a duplicação de lógica mais uma vez. É aqui que as <em>concerns</em> são úteis.</p><p>Uma <em>concerns</em> é responsável apenas por um subconjunto específico da responsabilidade do <em>model</em>; os métodos na nossa <em>concern</em> estarão todos relacionados à visibilidade de um <em>model</em>. Vamos chamar nossa nova <em>concern</em> (módulo) de <code>Visible</code>. Podemos criar um novo arquivo dentro de <code>app/models/concerns</code> chamado<code>visible.rb</code>, e armazenar todos os métodos de status que foram duplicados nos <em>models</em>.</p><p><code>app/models/concerns/visible.rb</code></p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">Visible</span>
  <span class="k">def</span> <span class="nf">archived?</span>
    <span class="n">status</span> <span class="o">==</span> <span class="s1">'archived'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-814ec61deede2505a13abd9b6556bd5f">module Visible
  def archived?
    status == 'archived'
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-814ec61deede2505a13abd9b6556bd5f">Copiar</button>
</div>
<p>Podemos adicionar nossa validação de status à <em>concern</em>, mas isso é um pouco mais complexo, pois as validações são métodos chamados no nível da classe. O <code>ActiveSupport::Concern</code> (<a href="https://api.rubyonrails.org/v6.1.0/classes/ActiveSupport/Concern.html">API Guide</a>) nos dá uma maneira mais simples de incluí-los:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">Visible</span>
  <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>

  <span class="n">included</span> <span class="k">do</span>
    <span class="no">VALID_STATUSES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'public'</span><span class="p">,</span> <span class="s1">'private'</span><span class="p">,</span> <span class="s1">'archived'</span><span class="p">]</span>

    <span class="n">validates</span> <span class="ss">:status</span><span class="p">,</span> <span class="ss">in: </span><span class="no">VALID_STATUSES</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">archived?</span>
    <span class="n">status</span> <span class="o">==</span> <span class="s1">'archived'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-f3f3172f072822ab97ab3eede217c937">module Visible
  extend ActiveSupport::Concern

  included do
    VALID_STATUSES = ['public', 'private', 'archived']

    validates :status, in: VALID_STATUSES
  end

  def archived?
    status == 'archived'
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-f3f3172f072822ab97ab3eede217c937">Copiar</button>
</div>
<p>Agora, podemos remover a lógica duplicada de cada <em>model</em> e, em vez disso, incluir nosso novo módulo <code>Visible</code>:</p><p>Em <code>app/models/article.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="kp">include</span> <span class="no">Visible</span>
  <span class="n">has_many</span> <span class="ss">:comments</span>

  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">10</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-4eb14286fabb0b07f5a1c92aa3ba7fc2">class Article &lt; ApplicationRecord
  include Visible
  has_many :comments

  validates :title, presence: true
  validates :body, presence: true, length: { minimum: 10 }
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-4eb14286fabb0b07f5a1c92aa3ba7fc2">Copiar</button>
</div>
<p>e em <code>app/models/comment.rb</code>:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Comment</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="kp">include</span> <span class="no">Visible</span>
  <span class="n">belongs_to</span> <span class="ss">:article</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-dcf0904cd35930f3bd904235b89d114d">class Comment &lt; ApplicationRecord
  include Visible
  belongs_to :article
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-dcf0904cd35930f3bd904235b89d114d">Copiar</button>
</div>
<p>Os métodos de classe também podem ser adicionados às <em>concerns</em>. Se quisermos que uma contagem de artigos públicos ou comentários sejam exibidos em nossa página principal, podemos adicionar um método de classe a <code>Visible</code> da seguinte maneira:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">module</span> <span class="nn">Visible</span>
  <span class="kp">extend</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">Concern</span>

  <span class="no">VALID_STATUSES</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'public'</span><span class="p">,</span> <span class="s1">'private'</span><span class="p">,</span> <span class="s1">'archived'</span><span class="p">]</span>

  <span class="n">included</span> <span class="k">do</span>
    <span class="n">validates</span> <span class="ss">:status</span><span class="p">,</span> <span class="ss">in: </span><span class="no">VALID_STATUSES</span>
  <span class="k">end</span>

  <span class="n">class_methods</span> <span class="k">do</span>
    <span class="k">def</span> <span class="nf">public_count</span>
      <span class="n">where</span><span class="p">(</span><span class="ss">status: </span><span class="s1">'public'</span><span class="p">).</span><span class="nf">count</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">archived?</span>
    <span class="n">status</span> <span class="o">==</span> <span class="s1">'archived'</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-48de1d7abb91ce16804ec5164fe7f4df">module Visible
  extend ActiveSupport::Concern

  VALID_STATUSES = ['public', 'private', 'archived']

  included do
    validates :status, in: VALID_STATUSES
  end

  class_methods do
    def public_count
      where(status: 'public').count
    end
  end

  def archived?
    status == 'archived'
  end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-48de1d7abb91ce16804ec5164fe7f4df">Copiar</button>
</div>
<p>Então, na <em>view</em>, você pode chamá-lo como qualquer método de classe:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;h1&gt;</span>Articles<span class="nt">&lt;/h1&gt;</span>

Our blog has <span class="cp">&lt;%=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">public_count</span> <span class="cp">%&gt;</span> articles and counting!

<span class="nt">&lt;ul&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@articles</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">article</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;li&gt;</span>
      <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="n">article</span><span class="p">.</span><span class="nf">title</span><span class="p">,</span> <span class="n">article</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/ul&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s2">"New Article"</span><span class="p">,</span> <span class="n">new_article_path</span> <span class="cp">%&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-57c4c17d36160a93e0e3186119822956">&lt;h1&gt;Articles&lt;/h1&gt;

Our blog has &lt;%= Article.public_count %&gt; articles and counting!

&lt;ul&gt;
  &lt;% @articles.each do |article| %&gt;
    &lt;li&gt;
      &lt;%= link_to article.title, article %&gt;
    &lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;

&lt;%= link_to "New Article", new_article_path %&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-57c4c17d36160a93e0e3186119822956">Copiar</button>
</div>
<h3 id="deletando-comentarios"><a class="anchorlink" href="#deletando-comentarios">9 Deletando Comentários</a></h3><p>Outra importante <em>feature</em> de um blog é excluir comentários de spam. Para fazer
isto, nós precisamos implementar um link de alguma <em>view</em> e uma <em>action</em>
<code>destroy</code> no <code>CommentsController</code>.</p><p>Primeiro, vamos adicionar o link <em>delete</em> na <em>partial</em>
<code>app/views/comments/_comment.html.erb</code>:</p><div class="code_container">
<pre><code class="highlight erb"><span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Autor do comentário:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">commenter</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;strong&gt;</span>Comentário:<span class="nt">&lt;/strong&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">comment</span><span class="p">.</span><span class="nf">body</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>

<span class="nt">&lt;p&gt;</span>
  <span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">'Destruir comentário'</span><span class="p">,</span> <span class="p">[</span><span class="n">comment</span><span class="p">.</span><span class="nf">article</span><span class="p">,</span> <span class="n">comment</span><span class="p">],</span>
               <span class="ss">method: :delete</span><span class="p">,</span>
               <span class="ss">data: </span><span class="p">{</span> <span class="ss">confirm: </span><span class="s2">"Você tem certeza?"</span> <span class="p">}</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/p&gt;</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-5e1338729efcdce74e6a59a7ded5b0c0">&lt;p&gt;
  &lt;strong&gt;Autor do comentário:&lt;/strong&gt;
  &lt;%= comment.commenter %&gt;
&lt;/p&gt;

&lt;p&gt;
  &lt;strong&gt;Comentário:&lt;/strong&gt;
  &lt;%= comment.body %&gt;
&lt;/p&gt;

&lt;p&gt;
  &lt;%= link_to 'Destruir comentário', [comment.article, comment],
               method: :delete,
               data: { confirm: "Você tem certeza?" } %&gt;
&lt;/p&gt;
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-5e1338729efcdce74e6a59a7ded5b0c0">Copiar</button>
</div>
<p>Clicar neste novo link "Destruir comentário" será disparado um <code>DELETE
/articles/:article_id/comments/:id</code> ao nosso <code>CommentsController</code>, que
pode ser usar isso para encontrar o comentário que queremos excluir, então vamos adicionar
uma ação <code>destroy</code> ao nosso <em>controller</em> (<code>app/controllers/comments_controller.rb</code>):</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:article_id</span><span class="p">])</span>
    <span class="vi">@comment</span> <span class="o">=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">comment_params</span><span class="p">)</span>
    <span class="n">redirect_to</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:article_id</span><span class="p">])</span>
    <span class="vi">@comment</span> <span class="o">=</span> <span class="vi">@article</span><span class="p">.</span><span class="nf">comments</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
    <span class="vi">@comment</span><span class="p">.</span><span class="nf">destroy</span>
    <span class="n">redirect_to</span> <span class="n">article_path</span><span class="p">(</span><span class="vi">@article</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="kp">private</span>
    <span class="k">def</span> <span class="nf">comment_params</span>
      <span class="n">params</span><span class="p">.</span><span class="nf">require</span><span class="p">(</span><span class="ss">:comment</span><span class="p">).</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:commenter</span><span class="p">,</span> <span class="ss">:body</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-b335f4424c4f3a9f7223577e58ecc646">class CommentsController &lt; ApplicationController
  def create
    @article = Article.find(params[:article_id])
    @comment = @article.comments.create(comment_params)
    redirect_to article_path(@article)
  end

  def destroy
    @article = Article.find(params[:article_id])
    @comment = @article.comments.find(params[:id])
    @comment.destroy
    redirect_to article_path(@article)
  end

  private
    def comment_params
      params.require(:comment).permit(:commenter, :body)
    end
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-b335f4424c4f3a9f7223577e58ecc646">Copiar</button>
</div>
<p>A <em>action</em> <code>destroy</code> vai encontrar o artigo que estamos vendo, localizar o
comentário na <em>collection</em> <code>@article.comments</code>, removê-lo do seu banco de
dados e nos enviar de volta para a <em>action</em> <code>show</code> do artigo.</p><h4 id="excluindo-objetos-associados"><a class="anchorlink" href="#excluindo-objetos-associados">9.1 Excluindo objetos associados</a></h4><p>Se você excluir um artigo, os comentários (comments) associados também precisarão ser
excluídos, caso contrário, eles simplesmente ocupariam espaço no banco de dados.
O Rails permite que você use a opção <code>dependent</code> de uma associação para conseguir isso.
Modifique o Modelo de artigo (article), <code>app/models/article.rb</code>, da seguinte forma:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">Article</span> <span class="o">&lt;</span> <span class="no">ApplicationRecord</span>
  <span class="kp">include</span> <span class="no">Visible</span>

  <span class="n">validates</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span>
  <span class="n">validates</span> <span class="ss">:body</span><span class="p">,</span> <span class="ss">presence: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">length: </span><span class="p">{</span> <span class="ss">minimum: </span><span class="mi">10</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-2e2df3f40ee498aa9e0defc8988853a0">class Article &lt; ApplicationRecord
  include Visible

  validates :title, presence: true
  validates :body, presence: true, length: { minimum: 10 }
end
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-2e2df3f40ee498aa9e0defc8988853a0">Copiar</button>
</div>
<h3 id="seguranca"><a class="anchorlink" href="#seguranca">10 Segurança</a></h3><h4 id="autenticacao-basica"><a class="anchorlink" href="#autenticacao-basica">10.1 Autenticação Básica</a></h4><p>Se fosse fosse publicar o seu blog online, qualquer um poderia adicionar, editar
e deletar seus artigos ou comentários.</p><p>O Rails disponibiliza um sistema de autenticação HTTP que funcionará
tranquilamente nesta situação.</p><p>No <code>ArticlesController</code> nós precisamos que tenha um meio de bloquear o acesso à
várias ações se uma pessoa não estiver autenticada. Aqui podemos usar o método
<code>http_basic_authenticate_with</code>, que permite o acesso para a ação requisitada se
o método deixar.</p><p>Para usar o sistema de autenticação, nós especificamos no topo do nosso
<code>ArticlesController</code> em <code>app/controllers/articles_controller.rb</code>. No nosso caso,
nós queremos que o usuário esteja autenticado em todas as ações, exceto <code>index</code>
e <code>show</code>, então nós colocamos isso:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">ArticlesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="n">http_basic_authenticate_with</span> <span class="ss">name: </span><span class="s2">"dhh"</span><span class="p">,</span> <span class="ss">password: </span><span class="s2">"secret"</span><span class="p">,</span> <span class="ss">except: </span><span class="p">[</span><span class="ss">:index</span><span class="p">,</span> <span class="ss">:show</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@articles</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">all</span>
  <span class="k">end</span>

  <span class="c1"># snippet for brevity</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-64026dd48491bffe6e30d61c77cf001a">class ArticlesController &lt; ApplicationController

  http_basic_authenticate_with name: "dhh", password: "secret", except: [:index, :show]

  def index
    @articles = Article.all
  end

  # snippet for brevity
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-64026dd48491bffe6e30d61c77cf001a">Copiar</button>
</div>
<p>Nós também queremos autorizar somente usuários autenticados a deletar
comentários, então em <code>CommentsController</code>
(<code>app/controllers/comments_controller.rb</code>) nós colocamos:</p><div class="code_container">
<pre><code class="highlight ruby"><span class="k">class</span> <span class="nc">CommentsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="n">http_basic_authenticate_with</span> <span class="ss">name: </span><span class="s2">"dhh"</span><span class="p">,</span> <span class="ss">password: </span><span class="s2">"secret"</span><span class="p">,</span> <span class="ss">only: :destroy</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="vi">@article</span> <span class="o">=</span> <span class="no">Article</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:article_id</span><span class="p">])</span>
    <span class="c1"># ...</span>
  <span class="k">end</span>

  <span class="c1"># snippet for brevity</span>
</code></pre>
<textarea class="clipboard-content" id="clipboard-abc89556a6864f33d41386085554f8d1">class CommentsController &lt; ApplicationController

  http_basic_authenticate_with name: "dhh", password: "secret", only: :destroy

  def create
    @article = Article.find(params[:article_id])
    # ...
  end

  # snippet for brevity
</textarea>
<button class="clipboard-button" data-clipboard-target="#clipboard-abc89556a6864f33d41386085554f8d1">Copiar</button>
</div>
<p>Agora se você tentar criar um novo artigo, você deverá preencher um formulário de autenticação:</p><p><img src="images/getting_started/challenge.png" alt="Formulário de Autenticação"></p><p>Outros métodos de autenticação estão disponíveis para aplicações Rails. Dois
<em>add-ons</em> de autenticação populares para Rails são o
<a href="https://github.com/plataformatec/devise">Devise</a> e o
<a href="https://github.com/binarylogic/authlogic">Authlogic</a> entre outros.</p><h4 id="outras-consideracoes-de-seguranca"><a class="anchorlink" href="#outras-consideracoes-de-seguranca">10.2 Outras Considerações de Segurança</a></h4><p>Segurança, especialmente em aplicações web, é uma area ampla e detalhada. O
tópico de segurança aplicações Rails é coberto com mais detalhes em
<a href="security.html">Guia de Segurança Ruby on Rails</a>.</p><h3 id="o-que-vem-depois-questionmark"><a class="anchorlink" href="#o-que-vem-depois-questionmark">11 O que vem depois?</a></h3><p>Agora que você criou sua primeira aplicação Rails, sinta-se à vontade para
atualizar e experimentar por conta própria.</p><p>Lembre-se, você não precisa fazer tudo sem ajuda. Se você precisa de
assistência para começar a desenvolver com Rails, sinta-se à vontade para
consultar estes recursos:</p>
<ul>
<li>O <a href="index.html">Guia Rails</a>
</li>
<li>O <a href="https://guides.rubyonrails.org">Ruby on Rails Guides</a>
</li>
<li>A <a href="https://discuss.rubyonrails.org/c/rubyonrails-talk">lista de discussão do Ruby on Rails</a>
</li>
<li>O canal <a href="irc://irc.freenode.net/#rubyonrails">#rubyonrails</a> no irc.freenode.net</li>
</ul>
<h3 id="dicas-de-configuracao"><a class="anchorlink" href="#dicas-de-configuracao">12 Dicas de Configuração</a></h3><p>O caminho mais fácil para se trabalhar com o Rails é armazenar todos os dados
externos como UTF-8. Se não fizer assim, as bibliotecas Ruby e o Rails vão, na
maioria das vezes, conseguir converter seus dados nativos em UTF-8, porém não
é sempre que isso funciona corretamente, então é melhor que você assegure que
todos seus dados externos estão em UTF-8.</p><p>Caso tenha cometido um erro nessa parte, o sintoma mais comum é o aparecimento
de um diamante preto com um ponto de interrogação dentro no seu navegador. Outro
sintoma comum é o aparecimento de caracteres como "Ã¼" ao invés de "ü". O Rails
executa um número de passos internos para mitigar causas comuns desses problemas
que possam ser detectadas e corrigidas automaticamente. Porém, caso você possua
dados externos que não estão armazenados como UTF-8, eles poderão ocasionalmente
resultar em problemas que não podem ser detectados e nem resolvidos de forma
automática pelo Rails.</p><p>Duas fontes muito comuns de dados que não estão em UTF-8 são:</p>
<ul>
<li>Seu editor de texto: A maioria dos editores de texto (como o TextMate), salvam
os arquivos em UTF-8 de forma padrão. Caso o seu editor de texto não salve,
isso pode resultar em caracteres especiais inseridos por você nos seus
<em>templates</em> (como por exemplo: é) aparecerem no navegador como um diamante
com um ponto de interrogação dentro. Isso também se aplica aos seus arquivos
de tradução i18n. Muitos editores que não salvam em UTF-8 por padrão (como
algumas versões do Dreamweaver) oferecem uma forma de alterar o padrão para
UTF-8. Faça isso.</li>
<li>Seu banco de dados: o Rails converte seus dados do banco de dados em UTF-8
de forma padrão. Porém, se seu banco de dados não está utilizando UTF-8
internamente, pode ser que não consiga armazenar todos os caracteres que seus
usuários insiram. Por exemplo, se seu banco de dados está utilizando Latin-1
internamente, e seu usuário inserir um caractere russo, hebraico ou japonês,
os dados serão perdidos para sempre assim que entrarem no banco de dados. Se
possível, utilize UTF-8 como padrão de armazenamento para o seu banco de dados.</li>
</ul>


        <h3>Feedback</h3>
        <p>
          Você é incentivado a ajudar a melhorar a qualidade deste guia.
        </p>
        <p>
          Por favor, contribua se vir qualquer erros, inclusive erros de digitação.
          Para começar, você pode ler nossa sessão de <a href="https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#contributing-to-the-rails-documentation">contribuindo com a documentação</a>.
        </p>
        <p>
          Você também pode encontrar conteúdo incompleto ou coisas que não estão atualizadas.
          Por favor, adicione qualquer documentação em falta na master do Rails. Certifique-se de checar o
          <a href="http://edgeguides.rubyonrails.org">Edge Guides (en-US)</a> primeiro para verificar
          se o problema já foi resolvido ou não no branch master.
          Verifique as <a href="ruby_on_rails_guides_guidelines.html">Diretrizes do Guia Ruby on Rails</a>
          para estilo e convenções.
        </p>
        <p>
          Se, por qualquer motivo, você encontrar algo para consertar, mas não conseguir consertá-lo, por favor
          <a href="https://github.com/campuscode/rails-guides-pt-BR/issues">abra uma issue no nosso Guia</a>.
        </p>
        <p>
          E por último, mas não menos importante, qualquer tipo de discussão sobre a documentação do Ruby on Rails
          é muito bem vinda na <a href="https://discuss.rubyonrails.org/c/rubyonrails-docs">lista de discussão rubyonrails-docs</a> e nas
          <a href="https://github.com/campuscode/rails-guides-pt-BR/issues">issues do Guia em português</a>.
        </p>
      </div>
    </div>
  </div>

  <hr class="hide" />
  <div id="footer">
    <div class="wrapper">
      <p> Este projeto está licenciado sob uma licença <a href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International</a></p>
<p>"Rails", "Ruby on Rails", e o logotipo Rails são marcas comerciais de David Heinemeier Hansson. Todos os direitos reservados.</p>

    </div>
  </div>
</body>
</html>
